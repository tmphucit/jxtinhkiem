Include("\\script\\cacnhiemvu\\datau\\diadochi\\head_datau.lua")
Include("\\Script\\Global\\sourcejx49.lua")
Include("\\Script\\header\\taskid.lua");
Include("\\Script\\lib\\worldlibrary.lua");
Include("\\Script\\lib\\thuvien.lua");

-----------------------------------------------------§Ã FIX OK 10/03/2024--------------------------------------------------------
-----------=======================-------------------------====================----------------------
----------=========================ANHVIETDONGNAI=====================----------------------
-----------=======================-------------------------====================----------------------

function main()
if GetLevel() < 60 then 
Talk(1,"","C¬ b¶n ngu¬i cßn yÕu l¾m, th¨ng cÊp 60 quay l¹i gÆp ta")
return end

ngay = tonumber(date("%d"))
gio = tonumber(date("%H"))
phut = tonumber(date("%M"))

if GetTask(DATAU_SHXT) < 0 then
SetTask(DATAU_SHXT,GetTask(DATAU_SHXT)+1000)
end

if GetTask(DATAU_GIAIDOAN) == 0 then -- Chua nhan nv
soluong = 20 - GetTask(DATAU_SOLAN)
SayNew("<color=green>D· TÈu: <color>: VÞ C«ng tö ®· hoµn thµnh <color=yellow>"..GetTask(DATAU_SOLAN).."<color> nhiÖm vô, nhiÖm vô nµy ngµy h«m nay cã thÓ thùc hiÖn l¹i <color=yellow>"..soluong.."<color> lÇn n÷a, ng­¬i cã muèn lµm n÷a kh«ng  ",3,
"Ta muèn nhËn nhiÖm vô d· tÈu /nhannv2", 
"PhÇn th­ëng nhiÖm vô d· tÈu /nhanptmoc",
"§Ó ta nghÜ ng¬i mét l¸t ®·! Ta bËn råi /no")
elseif GetTask(DATAU_GIAIDOAN) == 1 or GetTask(DATAU_GIAIDOAN) == 2 or GetTask(DATAU_GIAIDOAN) == 3 or GetTask(DATAU_GIAIDOAN) == 4 then -- Da nhan nv chua hoan thanh
	if GetTask(DATAU_LOAINV) == 1 then -- Tim do chi
	AddNote(1,"<color=green>D· TÈu: <color>: §©y lµ nhiÖm vô thø "..GetTask(DATAU_SOLAN).."/20, Ng­¬i h·y ®Õn <color=yellow>"..DoChi_Map[GetTask(DATAU_BANDO)][2].." t×m gióp ta "..GetTask(DATAU_DIEMNV).." tÊm ThÇn BÝ §å ChÝ ")
		SayNew("<color=green>D· TÈu: <color>: §©y lµ nhiÖm vô thø "..GetTask(DATAU_SOLAN).."/20, Ng­¬i h·y ®Õn <color=yellow>"..DoChi_Map[GetTask(DATAU_BANDO)][2].." t×m gióp ta "..GetTask(DATAU_DIEMNV).." tÊm ThÇn BÝ §å ChÝ ",3,
		"Ta ®· hoµn thµnh nhiÖm vô lÇn nµy /hoanthanh",
		"Ta muèn hñy bá nhiÖm vô kh«ng lµm n÷a /huy",
		"Ta ®ang bËn, hÑn gÆp ng­êi sau /no")
	elseif GetTask(DATAU_LOAINV) == 2 then -- tim mat chi
	AddNote(1,"<color=green>D· TÈu: <color>: §©y lµ nhiÖm vô thø "..GetTask(DATAU_SOLAN).."/20, Ng­¬i h·y ®Õn <color=yellow>"..DoChi_Map[GetTask(DATAU_BANDO)][2].." t×m gióp ta "..GetTask(DATAU_DIEMNV).." tÊm MËt ChÝ ")
		SayNew("<color=green>D· TÈu: <color>: §©y lµ nhiÖm vô thø "..GetTask(DATAU_SOLAN).."/20, Ng­¬i h·y ®Õn <color=yellow>"..DoChi_Map[GetTask(DATAU_BANDO)][2].." t×m gióp ta "..GetTask(DATAU_DIEMNV).." tÊm MËt ChÝ ",3,
		"Ta ®· hoµn thµnh nhiÖm vô lÇn nµy /hoanthanh",
		"Ta muèn hñy bá nhiÖm vô kh«ng lµm n÷a /huy",
		"Ta ®ang bËn, hÑn gÆp ng­êi sau /no")
	elseif GetTask(DATAU_LOAINV) == 3 then -- Mua Item Shop
	    AddNote(1,"<color=green>D· TÈu: <color>: §©y lµ nhiÖm vô thø "..GetTask(DATAU_SOLAN).."/20\nNg­¬i h·y ®Õn <color=yellow>"..Mua_Shop[GetTask(DATAU_BANDO)][1].." - "..Mua_Shop[GetTask(DATAU_BANDO)][2].." gióp ta mua "..Mua_Shop[GetTask(DATAU_BANDO)][3].." [CÊp "..Mua_Shop[GetTask(DATAU_BANDO)][6].."] ")
		SayNew("<color=green>D· TÈu: <color>: §©y lµ nhiÖm vô thø "..GetTask(DATAU_SOLAN).."/20\nNg­¬i h·y ®Õn <color=yellow>"..Mua_Shop[GetTask(DATAU_BANDO)][1].." - "..Mua_Shop[GetTask(DATAU_BANDO)][2].." gióp ta mua "..Mua_Shop[GetTask(DATAU_BANDO)][3].." [CÊp "..Mua_Shop[GetTask(DATAU_BANDO)][6].."] ",3,
		"§îi xi, ta sÏ ®i mua gióp ng­êi /no",
		"Ta ®Õn giao vËt phÈm nhiÖm vô /hoanthanh",
		"Ta muèn hñy bá nhiÖm vô kh«ng lµm n÷a /huy")
	elseif GetTask(DATAU_LOAINV) == 4 then -- Tim Trang Suc : Ten + He
	    AddNote(1,"<color=green>D· TÈu: <color>: §©y lµ nhiÖm vô thø "..GetTask(DATAU_SOLAN).."/20\nH·y t×m cho ta 1 <color=yellow>"..TrangSuc_Ten[GetTask(DATAU_BANDO)][1].." ")
		SayNew("<color=green>D· TÈu: <color>: §©y lµ nhiÖm vô thø "..GetTask(DATAU_SOLAN).."/20\nH·y t×m cho ta 1 <color=yellow>"..TrangSuc_Ten[GetTask(DATAU_BANDO)][1].."",3,
		"§îi xi, ta sÏ ®i mua gióp ng­êi /no",
		"Ta ®Õn giao vËt phÈm nhiÖm vô /hoanthanh",
		"Ta muèn hñy bá nhiÖm vô kh«ng lµm n÷a /huy")
	elseif GetTask(DATAU_LOAINV) == 5 then -- Tim Option
	AddNote(1,"<color=green>D· TÈu: <color>: §©y lµ nhiÖm vô thø "..GetTask(DATAU_SOLAN).."/20\nH·y t×m cho ta 1 trang bÞ cã <color=yellow>"..Option[GetTask(DATAU_BANDO)][1].." tõ "..Option[GetTask(DATAU_BANDO)][3].." ®Õn "..Option[GetTask(DATAU_BANDO)][4].." ")
		SayNew("<color=green>D· TÈu: <color>: §©y lµ nhiÖm vô thø "..GetTask(DATAU_SOLAN).."/20\nH·y t×m cho ta 1 trang bÞ cã <color=yellow>"..Option[GetTask(DATAU_BANDO)][1].." tõ "..Option[GetTask(DATAU_BANDO)][3].." ®Õn "..Option[GetTask(DATAU_BANDO)][4].." ",3,
		"§îi xi, ta sÏ ®i mua gióp ng­êi /no",
		"Ta ®Õn giao vËt phÈm nhiÖm vô /hoanthanh",
		"Ta muèn hñy bá nhiÖm vô kh«ng lµm n÷a /huy")
	elseif GetTask(DATAU_LOAINV) == 6 then -- Tim Trang suc _ Option
	AddNote(1,"<color=green>D· TÈu: <color>: §©y lµ nhiÖm vô thø "..GetTask(DATAU_SOLAN).."/20\nH·y t×m cho ta 1 trang bÞ <color=yellow>"..Item_Option[GetTask(DATAU_BANDO)][1].." cã "..Item_Option2[GetTask(DATAU_DIEMNV)][1].."")
		SayNew("<color=green>D· TÈu: <color>: §©y lµ nhiÖm vô thø "..GetTask(DATAU_SOLAN).."/20\nH·y t×m cho ta 1 trang bÞ <color=yellow>"..Item_Option[GetTask(DATAU_BANDO)][1].." cã "..Item_Option2[GetTask(DATAU_DIEMNV)][1].."",3,
		"§îi xi, ta sÏ ®i mua gióp ng­êi /no",
		"Ta ®Õn giao vËt phÈm nhiÖm vô /hoanthanh",
		"Ta muèn hñy bá nhiÖm vô kh«ng lµm n÷a /huy")
	elseif GetTask(DATAU_LOAINV) == 7 then -- TrÞ danh väng, phóc duyªn, tèng kim
	AddNote(1,"<color=green>D· TÈu: <color>: §©y lµ nhiÖm vô thø "..GetTask(DATAU_SOLAN).."/20, §· liªn tiÕp hoµn thµnh <color=red>"..GetTask(DATAU_LIENTIEP).."<color> nhiÖm vô.\nNg­¬i h·y ®i n©ng <color=yellow>"..Tri_Diem[GetTask(DATAU_BANDO)][1].." thªm "..Tri_Diem[GetTask(DATAU_BANDO)][3].." ®iÓm ")
		SayNew("<color=green>D· TÈu: <color>: §©y lµ nhiÖm vô thø "..GetTask(DATAU_SOLAN).."/20, §· liªn tiÕp hoµn thµnh <color=red>"..GetTask(DATAU_LIENTIEP).."<color> nhiÖm vô.\nNg­¬i h·y ®i n©ng <color=yellow>"..Tri_Diem[GetTask(DATAU_BANDO)][1].." thªm "..Tri_Diem[GetTask(DATAU_BANDO)][3].." ®iÓm ",3,
		"Ta ®· hoµn thµnh nhiÖm vô lÇn nµy /hoanthanh",
		"Ta muèn hñy bá nhiÖm vô kh«ng lµm n÷a /huy",
		"Ta ®ang bËn, hÑn gÆp ng­êi sau /no")
	elseif GetTask(DATAU_LOAINV) == 8 then -- TrÞ PK
	AddNote(1,"<color=green>D· TÈu: <color>: §©y lµ nhiÖm vô thø "..GetTask(DATAU_SOLAN).."/20, §· liªn tiÕp hoµn thµnh <color=red>"..GetTask(DATAU_LIENTIEP).."<color> nhiÖm vô.\nNg­¬i h·y ®i n©ng <color=yellow>trÞ PK lªn "..GetTask(DATAU_BANDO).."  ®iÓm ")
		SayNew("<color=green>D· TÈu: <color>: §©y lµ nhiÖm vô thø "..GetTask(DATAU_SOLAN).."/20, §· liªn tiÕp hoµn thµnh <color=red>"..GetTask(DATAU_LIENTIEP).."<color> nhiÖm vô.\nNg­¬i h·y ®i n©ng <color=yellow>trÞ PK lªn "..GetTask(DATAU_BANDO).."  ®iÓm ",3,
		"Ta ®· hoµn thµnh nhiÖm vô lÇn nµy /hoanthanh",
		"Ta muèn hñy bá nhiÖm vô kh«ng lµm n÷a /huy",
		"Ta ®ang bËn, hÑn gÆp ng­êi sau /no")
	elseif GetTask(DATAU_LOAINV) == 9 then -- TrÞ Kinh NghiÖm
	AddNote(1,"<color=green>D· TÈu: <color>: §©y lµ nhiÖm vô thø "..GetTask(DATAU_SOLAN).."/20, §· liªn tiÕp hoµn thµnh <color=red>"..GetTask(DATAU_LIENTIEP).."<color> nhiÖm vô.\nNg­¬i h·y ®i n©ng <color=yellow>TrÞ Kinh NghiÖm lªn "..GetTask(DATAU_BANDO).."  ®iÓm ")
		SayNew("<color=green>D· TÈu: <color>: §©y lµ nhiÖm vô thø "..GetTask(DATAU_SOLAN).."/20, §· liªn tiÕp hoµn thµnh <color=red>"..GetTask(DATAU_LIENTIEP).."<color> nhiÖm vô.\nNg­¬i h·y ®i n©ng <color=yellow>TrÞ Kinh NghiÖm lªn "..GetTask(DATAU_BANDO).."  ®iÓm ",3,
		"Ta ®· hoµn thµnh nhiÖm vô lÇn nµy /hoanthanh",
		"Ta muèn hñy bá nhiÖm vô kh«ng lµm n÷a /huy",
		"Ta ®ang bËn, hÑn gÆp ng­êi sau /no")
	end
end
end



function nhanptmoc()
if GetLevel() < 90 then 
Talk(1,"","§¼ng cÊp d­íi 90 kh«ng thÓ nhËn phÇn th­ëng ®Æc biÖt !")
return
end
if GetTask(DATAU_LIENTIEP) >= (GetTask(MOCPHANTHUONG)+1)*100 then
	SayNew("<color=green>D· TÈu: <color>: B¹n ®· hoµn thµnh <color=red>"..GetTask(DATAU_LIENTIEP).."<color> nhiÖm vô D· TÈu. Vui lßng nhËn phÇn th­ëng ®¹t mèc <color=yellow>"..((GetTask(MOCPHANTHUONG)+1)*100).."<color> cña m×nh ",2,
	"Ta ®Õn ®Ó nhËn phÇn th­ëng /nhanphanthuong",
	"Ta muèn xem danh s¸ch c¸c mèc phÇn th­ëng/xemdsmoc")
else
	SayNew("<color=green>D· TÈu: <color>: B¹n ®· hoµn thµnh <color=red>"..GetTask(DATAU_LIENTIEP).."<color> nhiÖm vô D· TÈu. PhÇn th­ëng nhËn ®­îc khi ®¹t mèc <color=yellow>"..((GetTask(MOCPHANTHUONG)+1)*100).."<color> nhiÖm vô hoµn thµnh liªn tiÕp ",2,
	"NhËn phÇn th­ëng hoµn thµnh 20 nhiÖm vô mçi ngµy/nhanptnvmoingay",
	"Ta sÏ cè g¾ng thªm /no",
	"Ta muèn xem danh s¸ch c¸c mèc phÇn th­ëng/xemdsmoc")
	
end
end

function nhanptnvmoingay()
nl = GetTask(DATAU_20NV)
if GetTask(DATAU_20NV) >= 100 then
	Talk(1,"","B¹n ®· nhËn phÇn th­ëng ngµy h«m nay råi !")
elseif GetTask(DATAU_20NV) >= 20 and GetTask(DATAU_20NV) < 100 then
	SetTask(DATAU_20NV,100)
	nhantuongdatau()
	
thoigian = tonumber(date("%H%M%d%m"))
LoginLog = openfile("Data/lognhanthuongmoc20nvdatau.txt", "a");
if LoginLog then
write(LoginLog,""..GetAccount().." - "..GetName().." - "..GetLevel().." - Time: "..thoigian.."\n");
end
closefile(LoginLog)
	Talk(0,"")
else
	Talk(1,"","B¹n hoµn thµnh "..GetTask(DATAU_20NV).." / 20 nhiÖm vô ngµy h«m nay, ch­a ®¹t yªu cÇu !")
end
end

function nhantuongdatau()
diemexp = random(1000000,2000000)
diemexp1 = random(2000000,3000000)

sx = random(1,100)
		if sx <= 25 then
				idxitem = AddEventItem(653)
				Msg2SubWorld("Chóc mõng "..GetName().." nhËn ®­îc <color=green> "..GetNameItemBox(idxitem).."<color> vµ 20 ®iÓm sù kiÖn tõ nhiÖm vô d· tÈu ")
				SetTask(DIEM_SUKIEN,GetTask(DIEM_SUKIEN)+20)
                                                       AddOwnExp(1000000)
		elseif sx > 26 and sx <= 50 then
				AddOwnExp(diemexp)
				Msg2SubWorld("Chóc mõng "..GetName().." nhËn ®­îc <color=green> "..diemexp.." <color>Exp vµ 20 ®iÓm sù kiÖn tõ nhiÖm vô d· tÈu!")
				SetTask(DIEM_SUKIEN,GetTask(DIEM_SUKIEN)+20)
                                                       AddOwnExp(1000000)
		elseif sx > 50 and sx <= 75 then
				m = random(10000,50000)
				Earn(m)
                                                        AddOwnExp(1000000)
				SetTask(DIEM_SUKIEN,GetTask(DIEM_SUKIEN)+20)
				Msg2SubWorld("Chóc mõng "..GetName().." nhËn ®­îc <color=green> "..m.." <color> l­îng vµ 20 ®iÓm sù kiÖn tõ nhiÖm vô d· tÈu!")
		elseif sx > 75 and sx <= 94 then
				idxitem = AddEventItem(283)
				SetTask(DIEM_SUKIEN,GetTask(DIEM_SUKIEN)+20)
                                                        AddOwnExp(1000000)
				Msg2SubWorld("Chóc mõng "..GetName().." nhËn ®­îc <color=green> "..GetNameItemBox(idxitem).."<color> vµ 20 ®iÓm sù kiÖn tõ nhiÖm vô d· tÈu ")
		else
				AddOwnExp(1000000)
				Msg2SubWorld("Chóc mõng "..GetName().." nhËn ®­îc <color=green> 1 triÖu <color> Exp vµ 20 ®iÓm sù kiÖn tõ nhiÖm vô d· tÈu!")
				SetTask(DIEM_SUKIEN,GetTask(DIEM_SUKIEN)+20)
				Msg2Player("B¹n nhËn ®­îc 20 ®iÓm sù kiÖn")

	
			
		end
end

function nhanphanthuong()
if CheckFreeBoxItem(0,10,5,1) == 0 then
Talk(1,"","§Ó trèng hµnh trang 2 x 3 « ®Ó nhËn phÇn th­ëng , nÕu kh«ng sÏ bÞ mÊt !")
return
end

sl = GetTask(MOCPHANTHUONG)
if GetTask(DATAU_LIENTIEP) >= MANG_MOC[sl+1][1] then
	SetTask(MOCPHANTHUONG,GetTask(MOCPHANTHUONG)+1)
	if GetTask(MOCPHANTHUONG) == sl+1 then
		phanthuongmoc(GetTask(MOCPHANTHUONG))
		Talk(0,"")
	else
		Talk(1,"","Hack ha em")
	end
else
	Talk(1,"","hack ha em")
end
end

MANG_MOC = {
{100,1},
{200,1},
{300,2},
{400,1},
{500,1},
{600,1},
{700,2},
{800,1},
{900,1},
{1000,7},
{1100,1},
{1200,1},
{1300,7},
{1400,1},
{1500,7},
{1600,1},
{1700,1},
{1800,1},
{1900,1},
{2000,8},
{2100,1},
{2200,1},
{2300,1},
{2400,1},
{2500,8},
{2600,1},
{2700,1},
{2800,1},
{2900,1},
{3000,3},
{3100,1},
{3200,1},
{3300,1},
{3400,1},
{3500,8},
{3600,1},
{3700,1},
{3800,1},
{3900,1},
{4000,8},
{4100,1},
{4200,1},
{4300,1},
{4400,1},
{4500,8},
}


function phanthuongmoc(vt)
if  MANG_MOC[vt][2] == 1 then
		sx = random(1,150)
		if sx < 120 then
			sx2 = random(1,30)
			if sx2 == 1 then
				idxitem = AddEventItem(120)
				Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")
			elseif sx2 == 2 then
				idxitem = AddEventItem(random(283,291))
				Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")
			else
				idxitem = AddEventItem(random(117,118))
				Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")
			end
			elseif sx >= 120 and sx < 140 then
				idxitem = AddEventItem(random(28,31))
				Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")
			elseif sx >= 140 and sx < 150 then
				idxitem = AddEventItem(random(283,291))
				Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")
			else
				idxitem = AddEventItem(random(0,1))
				Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")
			end
	elseif  MANG_MOC[vt][2] == 2 then
				sx = random(1,100)
		if sx < 65 then
			idxitem = AddItem(0,6,3,random(5,10),0,0,0)
			Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")
		elseif sx >= 65 and sx < 70 then
			idxitem = AddItem(0,7,15,random(5,10),0,0,0)
			Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")
		elseif sx >= 70 and sx < 80 then
			idxitem = AddItem(0,8,3,random(5,10),0,0,0)
			Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")
		elseif sx >= 80 and sx < 90 then
			idxitem = AddItem(0,5,5,random(5,10),0,0,0)
			Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")
		else
			idxitem = AddItem(0,2,30,random(5,10),0,0,0)
			Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")	
		end
	elseif  MANG_MOC[vt][2] == 3 then
				sx = random(1,100)
		if sx < 65 then
			idxitem = AddEventItem(243)
			Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")
		elseif sx >= 65 and sx < 70 then
			idxitem = AddEventItem(243)
			Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")
		elseif sx >= 70 and sx < 80 then
			idxitem = AddEventItem(243)
			Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")
		elseif sx >= 80 and sx < 90 then
			idxitem = AddEventItem(243)
			Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")
		else
			idxitem = AddEventItem(243)
			Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")	
		end
	elseif  MANG_MOC[vt][2] == 4 then
				sx = random(1,100)
		if sx < 65 then
			idxitem = AddItem(0,6,3,random(5,10),0,0,0)
			Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")
		elseif sx >= 65 and sx < 70 then
			idxitem = AddItem(0,7,15,random(5,10),0,0,0)
			Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")
		elseif sx >= 70 and sx < 80 then
			idxitem = AddItem(0,8,3,random(5,10),0,0,0)
			Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")
		elseif sx >= 80 and sx < 90 then
			idxitem = AddItem(0,5,5,random(5,10),0,0,0)
			Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")
		else
			idxitem = AddItem(0,2,30,random(5,10),0,0,0)
			Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")	
		end
	elseif  MANG_MOC[vt][2] == 5 then
				sx = random(1,100)
		if sx < 65 then
			idxitem = AddItem(0,6,3,random(5,10),0,0,0)
			Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")
		elseif sx >= 65 and sx < 70 then
			idxitem = AddItem(0,7,15,random(5,10),0,0,0)
			Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")
		elseif sx >= 70 and sx < 80 then
			idxitem = AddItem(0,8,3,random(5,10),0,0,0)
			Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")
		elseif sx >= 80 and sx < 90 then
			idxitem = AddItem(0,5,5,random(5,10),0,0,0)
			Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")
		else
			idxitem = AddItem(0,2,30,random(5,10),0,0,0)
			Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")	
		end
	elseif  MANG_MOC[vt][2] == 6 then
				sx = random(1,100)
		if sx < 65 then
			idxitem = AddItem(0,6,3,random(5,10),0,0,0)
			Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")
		elseif sx >= 65 and sx < 70 then
			idxitem = AddItem(0,7,15,random(5,10),0,0,0)
			Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")
		elseif sx >= 70 and sx < 80 then
			idxitem = AddItem(0,8,3,random(5,10),0,0,0)
			Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")
		elseif sx >= 80 and sx < 90 then
			idxitem = AddItem(0,5,5,random(5,10),0,0,0)
			Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")
		else
			idxitem = AddItem(0,2,30,random(5,10),0,0,0)
			Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")	
		end
elseif  MANG_MOC[vt][2] == 7 then
				sx = random(1,100)
				if sx < 75 then
					idxitem = 
					Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")
				elseif sx >= 75 and sx < 80 then
					idxitem = AddItem(0,2,30,random(5,10),0,0,0)
					Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")
				elseif sx >= 80 and sx < 90 then
					idxitem = AddItem(0,8,3,random(5,10),0,0,0)
					Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")
				else
					idxitem = AddItem(0,6,3,random(5,10),0,0,0)
					Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")	
				end
elseif  MANG_MOC[vt][2] == 8 then
		sx = random(1,100)
				if sx < 75 then
					idxitem = AddItem(0,9,3,1,0,0,0)
					Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")
				elseif sx >= 75 and sx < 80 then
					idxitem = AddItem(0,3,3,1,0,0,0)
					Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")
				elseif sx >= 80 and sx < 90 then
					idxitem = AddItem(0,3,4,1,0,0,0)
					Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")
				else
					AddItem(0,4,3,random(5,7),0,0,0)
					Msg2SubWorld(""..GetName().." ®¹t mèc "..(GetTask(MOCPHANTHUONG)*100).." nhiÖm vô d· tÈu liªn tiÕp nhËn ®­îc: <color=yellow>"..GetNameItemBox(idxitem).."")	
				end

elseif  MANG_MOC[vt][2] == 4 then
		Msg2Player("Nhan duoc phan thuogn 4")
--KickOutSelf()
end
end

function xemdsmoc()
SayNew("<color=green>D· TÈu: <color>: Chän mèc nhËn phÇn th­ëng: ",7,
"§¹t mèc 100, 200, .... nhiÖm vô /moc1",
"§¹t mèc 300 nhiÖm vô /moc1",
"§¹t mèc 700 nhiÖm vô /moc1",
"§¹t mèc 1000 nhiÖm vô /moc1",
"§¹t mèc 1200 nhiÖm vô /moc1",
"§¹t mèc 1500 nhiÖm vô /moc1",
"Tho¸t./no")
end

function moc1(nsel)
i = nsel+1
if i == 1 then
	Talk(1,"","§¹t c¸c mèc 100, 200,... nhiÖm vô sÏ nhËn ®­îc 1 trong c¸c vËt phÈm: <color=yellow>Tiªn Th¶o Lé, N÷ Nhi Hång, Thñy Tinh, Tinh Hång B¶o Th¹ch, TÈy Tñy Kinh, Vâ L©m MËt TÞch, BK 9x ")
elseif i == 2 then
	Talk(1,"","§¹t c¸c mèc 300 nhiÖm vô sÏ nhËn ®­îc: <color=yellow>Trang bÞ ®Þnh quèc ngÉu nhiªn")
elseif i == 3 then
	Talk(1,"","§¹t c¸c mèc 700 nhiÖm vô nhËn ®­îc: <color=yellow>Trang bÞ ®Þnh quèc ngÉu nhiªnn")
elseif i == 4 then
	Talk(1,"","§¹t c¸c mèc 1000 nhiÖm vô nhËn ®­îc: <color=yellow>Trang bÞ ®Þnh quèc ngÉu nhiªn")
elseif i == 5 then
	Talk(1,"","§¹t c¸c mèc 1200 nhiÖm vô nhËn ®­îc:<color=yellow> Trang bÞ ®Þnh quèc ngÉu nhiªn")
elseif i == 6 then
	Talk(1,"","§¹t c¸c mèc 1500 nhiÖm vô nhËn ®­îc:<color=yellow> Trang bÞ ®Þnh quèc ngÉu nhiªn")
end
end

function hoanthanh()
if GetTask(DATAU_GIAIDOAN) == 1 then -- Dang lam nhiem vu
	if GetTask(DATAU_LOAINV) == 1 or GetTask(DATAU_LOAINV) == 2 then
		if GetTask(DATAU_DATCUOC) >= GetTask(DATAU_DIEMNV) then
			nl = GetTask(DATAU_GIAIDOAN)
			SetTask(DATAU_GIAIDOAN,GetTask(DATAU_GIAIDOAN)+1)
			if (GetTask(DATAU_GIAIDOAN) == nl+1) then
				nl2 = GetTask(DATAU_LIENTIEP)
				SetTask(DATAU_LIENTIEP,GetTask(DATAU_LIENTIEP)+1)
				if GetTask(DATAU_LIENTIEP) == nl2+1 then
					hoanthanh()
					Talk(0,"")
				else
					Talk(1,"","Hack ha em")
				end
			else
				Talk(1,"","Hack ha em")
			end
		else
			SayNew("<color=green>D· TÈu: <color>: Ng­êi chØ t×m ®­îc "..GetTask(DATAU_DATCUOC).." / "..GetTask(DATAU_DIEMNV).." tÊm mµ muèn hoµn thµnh nhiÖm vô µ, h·y ®i t×m nhanh lªn !",1,
			"V©ng ta sÏ ®i ngay /no")
		end
	elseif GetTask(DATAU_LOAINV) == 3 or GetTask(DATAU_LOAINV) == 4 or GetTask(DATAU_LOAINV) == 5  or GetTask(DATAU_LOAINV) == 6 then
		giaonhiemvu()
	elseif GetTask(DATAU_LOAINV) == 7 then
		SetTask(DATAU_DATCUOC,GetTask(Tri_Diem[GetTask(DATAU_BANDO)][2]))
		if GetTask(DATAU_DATCUOC) >= GetTask(DATAU_DIEMNV) then
			nl = GetTask(DATAU_GIAIDOAN)
			SetTask(DATAU_GIAIDOAN,GetTask(DATAU_GIAIDOAN)+1)
			if (GetTask(DATAU_GIAIDOAN) == nl+1) then
				nl2 = GetTask(DATAU_LIENTIEP)
				SetTask(DATAU_LIENTIEP,GetTask(DATAU_LIENTIEP)+1)
				if GetTask(DATAU_LIENTIEP) == nl2+1 then
					hoanthanh()
					Talk(0,"")
				else
					Talk(1,"","Hack ha em")
				end
			else
				Talk(1,"","Hack ha em")
			end
		else
			sl = Tri_Diem[GetTask(DATAU_BANDO)][3] - (GetTask(DATAU_DIEMNV)-GetTask(DATAU_DATCUOC))
			SayNew("<color=green>D· TÈu: <color>: Ng­êi chØ n©ng <color=yellow>"..Tri_Diem[GetTask(DATAU_BANDO)][1].."<color> ®­îc <color=red>"..sl.." / "..Tri_Diem[GetTask(DATAU_BANDO)][3].."<color> ®iÓm, cè g¾ng lªn !",1,
			"V©ng ta sÏ ®i ngay /no")
		end
	elseif GetTask(DATAU_LOAINV) == 8 then
		SetTask(DATAU_DATCUOC,GetPK())
		if GetTask(DATAU_DATCUOC) >= GetTask(DATAU_DIEMNV) then
			nl = GetTask(DATAU_GIAIDOAN)
			SetTask(DATAU_GIAIDOAN,GetTask(DATAU_GIAIDOAN)+1)
			if (GetTask(DATAU_GIAIDOAN) == nl+1) then
				nl2 = GetTask(DATAU_LIENTIEP)
				SetTask(DATAU_LIENTIEP,GetTask(DATAU_LIENTIEP)+1)
				if GetTask(DATAU_LIENTIEP) == nl2+1 then
					hoanthanh()
					Talk(0,"")
				else
					Talk(1,"","Hack ha em")
				end
			else
				Talk(1,"","Hack ha em")
			end
		else
			sl = GetTask(DATAU_BANDO) - (GetTask(DATAU_DIEMNV)-GetTask(DATAU_DATCUOC))
			SayNew("<color=green>D· TÈu: <color>: Ng­êi chØ n©ng <color=yellow>TrÞ PK<color> ®­îc <color=red>"..sl.." / "..GetTask(DATAU_BANDO).."<color> ®iÓm, cè g¾ng lªn !",1,
			"V©ng ta sÏ ®i ngay /no")
		end
	elseif GetTask(DATAU_LOAINV) == 9 then
		if GetTask(DATAU_KINHNGHIEM1) == 1 then
			SetTask(DATAU_DATCUOC,GetExp())
			if GetTask(DATAU_DATCUOC) >= GetTask(DATAU_DIEMNV) then
				nl = GetTask(DATAU_GIAIDOAN)
				SetTask(DATAU_GIAIDOAN,GetTask(DATAU_GIAIDOAN)+1)
				if (GetTask(DATAU_GIAIDOAN) == nl+1) then
					nl2 = GetTask(DATAU_LIENTIEP)
					SetTask(DATAU_LIENTIEP,GetTask(DATAU_LIENTIEP)+1)
					if GetTask(DATAU_LIENTIEP) == nl2+1 then
						hoanthanh()
						Talk(0,"")
					else
						Talk(1,"","Hack ha em")
					end
				else
					Talk(1,"","Hack ha em")
				end
			else
				sl = GetTask(DATAU_BANDO) - (GetTask(DATAU_DIEMNV)-GetTask(DATAU_DATCUOC))
				SayNew("<color=green>D· TÈu: <color>: Ng­êi chØ n©ng <color=yellow>TrÞ Kinh NghiÖm<color> ®­îc <color=red>"..sl.." / "..GetTask(DATAU_BANDO).."<color> ®iÓm, cè g¾ng lªn !",1,
				"V©ng ta sÏ ®i ngay /no")
			end
		elseif GetTask(DATAU_KINHNGHIEM1) == 2 then
			if GetLevel() > GetTask(DATAU_DATCUOC) then
				nl = GetTask(DATAU_GIAIDOAN)
				SetTask(DATAU_GIAIDOAN,GetTask(DATAU_GIAIDOAN)+1)
				if (GetTask(DATAU_GIAIDOAN) == nl+1) then
					nl2 = GetTask(DATAU_LIENTIEP)
					SetTask(DATAU_LIENTIEP,GetTask(DATAU_LIENTIEP)+1)
					if GetTask(DATAU_LIENTIEP) == nl2+1 then
						hoanthanh()
						Talk(0,"")
					else
						Talk(1,"","Hack ha em")
					end
				else
					Talk(1,"","Hack ha em")
				end
			elseif GetLevel() == GetTask(DATAU_DATCUOC) then
				if GetExp() >= GetTask(DATAU_DIEMNV) then
					nl = GetTask(DATAU_GIAIDOAN)
					SetTask(DATAU_GIAIDOAN,GetTask(DATAU_GIAIDOAN)+1)
					if (GetTask(DATAU_GIAIDOAN) == nl+1) then
						nl2 = GetTask(DATAU_LIENTIEP)
						SetTask(DATAU_LIENTIEP,GetTask(DATAU_LIENTIEP)+1)
						if GetTask(DATAU_LIENTIEP) == nl2+1 then
							hoanthanh()
							Talk(0,"")
						else
							Talk(1,"","Hack ha em")
						end
					else
						Talk(1,"","Hack ha em")
					end
				else	
					sl1 = GetTask(DATAU_BANDO) - GetTask(DATAU_DIEMNV)
					sl2 = sl1 + GetExp()
					SayNew("<color=green>D· TÈu: <color>: Ng­êi chØ n©ng <color=yellow>TrÞ Kinh NghiÖm<color> ®­îc <color=red>"..sl2.." / "..GetTask(DATAU_BANDO).."<color> ®iÓm, cè g¾ng lªn !",1,
					"V©ng ta sÏ ®i ngay /no")
				end		
			else
				sl1 = GetTask(DATAU_BANDO) - GetTask(DATAU_DIEMNV)
				sl2 = GetLevelExp() - sl1
				sl3 = GetExp() - sl2
				SayNew("<color=green>D· TÈu: <color>: Ng­êi chØ n©ng <color=yellow>TrÞ Kinh NghiÖm<color> ®­îc <color=red>"..sl3.." / "..GetTask(DATAU_BANDO).."<color> ®iÓm, cè g¾ng lªn !",1,
				"V©ng ta sÏ ®i ngay /no")
			end
		end
	end
elseif GetTask(DATAU_GIAIDOAN) == 2 then -- Da hoan thanh nhung chua nhan thuong
	SetTask(DATAU_PHANTHUONG1, Win_Item_DuocPham())
	SetTask(DATAU_PHANTHUONG2, Win_Gold() / 2)
	SetTask(DATAU_PHANTHUONG3, Win_Exp() * 20)
	SetTask(308, RandomNew(1,5))
	nl = GetTask(DATAU_GIAIDOAN)
	SetTask(DATAU_GIAIDOAN,GetTask(DATAU_GIAIDOAN)+1)
	if (GetTask(DATAU_GIAIDOAN) == nl+1) then
				hoanthanh()
	else
		Talk(1,"","Hack ha em")
	end
elseif GetTask(DATAU_GIAIDOAN) == 3 then -- Da xac nhan phan thuong chi viec chon
	if GetTask(DATAU_PHANTHUONG1) > 0 and GetTask(DATAU_PHANTHUONG1) <= getn(Mang_Win_Item) then
			SayNew("<color=green>D· TÈu<color>: Vui lßng chän phÇn th­ëng: ",4,
			"- "..Mang_Win_Item[GetTask(DATAU_PHANTHUONG1)][2].." /phanthuongnew",
			"- "..GetTask(DATAU_PHANTHUONG2).." l­îng/phanthuongnew",
			"- "..GetTask(DATAU_PHANTHUONG3).." kinh nghiÖm/phanthuongnew",
			"- C¬ héi hñy bá nhiÖm vô/phanthuongnew")
	--	OpenSlectBoxCheck(GetTask(DATAU_PHANTHUONG1),GetTask(DATAU_PHANTHUONG2),GetTask(DATAU_PHANTHUONG3),"phanthuong")
	else
		Talk(1,"","Hack ha em")
	end
	
end
end

function Win_Item_DuocPham()
-- xxx
nhom1 = RandomNew(1,9)
nhom2 = RandomNew(1,9)
nhom3 = RandomNew(1,15)
nhom4 = RandomNew(1,15)
nhom5 = RandomNew(1,22)
nhom6 = RandomNew(1,29)
nhom7 = RandomNew(1,60)

loainv = GetTask(DATAU_LOAINV)
if GetLevel() < 10 then
	return nhom1
elseif GetLevel() >= 10 and GetLevel() < 80 then
	sx = RandomNew(1,100)
	if sx < 70 then
		return nhom1
	else
		return nhom2
	end
else
	if loainv == 1 then
			sx = RandomNew(1,1000)
			if sx < 700 then
				return nhom1
			elseif sx >= 700 and sx < 950 then
				return nhom2
			elseif sx >= 950 and sx < 980 then
				return nhom3
			elseif sx >= 980 and sx < 993 then
				return nhom4
			elseif sx >= 993 and sx < 998 then
				return nhom5
			elseif sx >= 998 and sx < 1000 then
				return nhom6
			else
				return nhom7
			end
	elseif loainv == 3 then
			sx = RandomNew(1,1000)
			if sx < 900 then
				return nhom1
			elseif sx >= 900 and sx < 950 then
				return nhom2
			elseif sx >= 950 and sx < 990 then
				return nhom3
			elseif sx >= 990 and sx < 998 then
				return nhom4
			else
				return nhom5
			end
	elseif loainv == 2 then
		sx = RandomNew(1,1000)
			if sx < 500 then
				return nhom1
			elseif sx >= 500 and sx < 800 then
				return nhom2
			elseif sx >= 800 and sx < 850 then
				return nhom3
			elseif sx >= 850 and sx < 900 then
				return nhom4
			elseif sx >= 950 and sx < 980 then
				return nhom5
			elseif sx >= 980 and sx < 1000 then
				return nhom6
			else
				return nhom7
			end
	elseif loainv == 4 or loainv == 6 then
					sx = RandomNew(1,1000)
			if sx < 500 then
				return nhom1
			elseif sx >= 500 and sx < 800 then
				return nhom2
			elseif sx >= 800 and sx < 850 then
				return nhom3
			elseif sx >= 850 and sx < 950 then
				return nhom4
			elseif sx >= 950 and sx < 980 then
				return nhom5
			elseif sx >= 980 and sx < 1000 then
				return nhom6
			else
				return nhom7
			end
	elseif loainv == 5 then
			sx = RandomNew(1,1000)
			if sx < 800 then
				return nhom1
			elseif sx >= 800 and sx < 900 then
				return nhom2
			elseif sx >= 900 and sx < 980 then
				return nhom3
			elseif sx >= 980 and sx < 995 then
				return nhom4
			elseif sx >= 995 and sx < 1000 then
				return nhom5
			else
				return nhom6
			end
	else
		return 1
	end	
end
end

function Win_Gold_New()
nhom1 = RandomNew(500,1000)
nhom2 = RandomNew(5000,10000)
nhom3 = RandomNew(10000,20000)
nhom4 = RandomNew(20000,30000)
nhom5 = RandomNew(30000,40000)
nhom6 = RandomNew(50000,100000)
nhom7 = RandomNew(100000,300000)

loainv = GetTask(DATAU_LOAINV)
if GetLevel() < 10 then
	return nhom1
elseif GetLevel() >= 10 and GetLevel() < 30 then
	sx = RandomNew(1,100)
	if sx < 70 then
		return nhom1
	else
		return nhom2
	end
else
	if loainv == 1 then
			sx = RandomNew(1,1000)
			if sx < 700 then
				return nhom1
			elseif sx >= 700 and sx < 800 then
				return nhom2
			elseif sx >= 800 and sx < 850 then
				return nhom3
			elseif sx >= 850 and sx < 900 then
				return nhom4
			elseif sx >= 900 and sx < 980 then
				return nhom5
			elseif sx >= 980 and sx < 1000 then
				return nhom6
			else
				return nhom7
			end
	elseif loainv == 3 then
			sx = RandomNew(1,1000)
			if sx < 700 then
				return nhom1
			elseif sx >= 700 and sx < 800 then
				return nhom2
			elseif sx >= 800 and sx < 900 then
				return nhom3
			elseif sx >= 900 and sx < 990 then
				return nhom4
			else
				return nhom5
			end
	elseif loainv == 2 then
		sx = RandomNew(1,1000)
			if sx < 200 then
				return nhom1
			elseif sx >= 200 and sx < 400 then
				return nhom2
			elseif sx >= 400 and sx < 600 then
				return nhom3
			elseif sx >= 600 and sx < 750 then
				return nhom4
			elseif sx >= 750 and sx < 950 then
				return nhom5
			elseif sx >= 950 and sx < 990 then
				return nhom6
			else
				return nhom7
			end
	elseif loainv == 4 or loainv == 6 then
					sx = RandomNew(1,1000)
			if sx < 200 then
				return nhom1
			elseif sx >= 200 and sx < 400 then
				return nhom2
			elseif sx >= 400 and sx < 700 then
				return nhom3
			elseif sx >= 700 and sx < 900 then
				return nhom4
			elseif sx >= 900 and sx < 990 then
				return nhom5
			elseif sx >= 990 and sx < 998 then
				return nhom6
			else
				return nhom7
			end
	elseif loainv == 5 then
			sx = RandomNew(1,1000)
			if sx < 600 then
				return nhom1
			elseif sx >= 600 and sx < 800 then
				return nhom2
			elseif sx >= 80 and sx < 900 then
				return nhom3
			elseif sx >= 900 and sx < 970 then
				return nhom4
			elseif sx >= 970 and sx < 998 then
				return nhom5
			else
				return nhom6
			end
	else
		return 1
	end	
end
end




function Win_Exp_New()
loainv = GetTask(DATAU_LOAINV)
nExp3 = 9000000

	if loainv == 1 then
		nExp = nExp3
	elseif loainv == 3 then
		nExp = nExp3 / 3
	elseif loainv == 2 then
		nExp = nExp3 * 2
	elseif loainv == 4 or loainv == 6 then
		nExp = nExp3 * 3/2
	elseif loainv == 5 then
		nExp = nExp3 * 2/ 3
	else
		nExp = nExp3
	end	
	
nExp = nExp * RandomNew(80,120) / 100	

return nExp
end



function phanthuongnew(nsel)
	i = nsel + 1
	nl = GetTask(DATAU_GIAIDOAN)
	SetTask(DATAU_GIAIDOAN,GetTask(DATAU_GIAIDOAN)-3)
	if GetTask(DATAU_GIAIDOAN) == nl-3 then
		if i == 1 then
				giatri = Mang_Win_Item[GetTask(DATAU_PHANTHUONG1)][1]
				if giatri == 0 then
					AddEventItem(Mang_Win_Item[GetTask(DATAU_PHANTHUONG1)][3])
				else
					for t=1,giatri do AddItem(Mang_Win_Item[GetTask(DATAU_PHANTHUONG1)][3],Mang_Win_Item[GetTask(DATAU_PHANTHUONG1)][4],Mang_Win_Item[GetTask(DATAU_PHANTHUONG1)][5],Mang_Win_Item[GetTask(DATAU_PHANTHUONG1)][6],0,0,0) end
				end
				if GetTask(DATAU_PHANTHUONG1) > 30 then
					Msg2SubWorld("§¹i hiÖp "..GetName().." hoµn thµnh NhiÖm Vô D· TÈu nhËn ®­îc <color=yellow>"..Mang_Win_Item[GetTask(DATAU_PHANTHUONG1)][2].."")
				else
					Msg2Player("B¹n nhËn ®­îc <color=yellow>"..Mang_Win_Item[GetTask(DATAU_PHANTHUONG1)][2].."")
				end
		elseif i == 2 then
				cash = GetCash()
				Earn(GetTask(DATAU_PHANTHUONG2))
				Msg2Player("B¹n nhËn ®­îc <color=yellow>"..GetTask(DATAU_PHANTHUONG2).."<color> l­îng")
				if  GetTask(DATAU_PHANTHUONG2) >= 300000 then
					Msg2SubWorld("<color=pink>Chóc mõng "..GetName().." hoµn thµnh nhiÖm vô D· TÈu nhËn ®­îc "..GetTask(DATAU_PHANTHUONG2).."<color> l­îng")
				elseif  GetTask(DATAU_PHANTHUONG2) >= 200000 then
					Msg2SubWorld("<color=green>Chóc mõng "..GetName().." hoµn thµnh nhiÖm vô D· TÈu nhËn ®­îc "..GetTask(DATAU_PHANTHUONG2).."<color> l­îng")
				elseif  GetTask(DATAU_PHANTHUONG2) >= 120000 then
					Msg2SubWorld("<color=yellow>Chóc mõng "..GetName().." hoµn thµnh nhiÖm vô D· TÈu nhËn ®­îc "..GetTask(DATAU_PHANTHUONG2).."<color> l­îng")
				elseif GetTask(DATAU_PHANTHUONG2) >= 80000 then
					Msg2SubWorld("<color=blue>Chóc mõng "..GetName().." hoµn thµnh nhiÖm vô D· TÈu nhËn ®­îc "..GetTask(DATAU_PHANTHUONG2).."<color> l­îng")
				end
				SetTask(DATAU_PHANTHUONG2,0)
		elseif i == 3 then
				m = floor(GetTask(DATAU_PHANTHUONG3) / 1000)
				for i=1,1000 do AddOwnExp(m) end
				Msg2Player("B¹n nhËn ®­îc <color=yellow>"..GetTask(DATAU_PHANTHUONG3).." kinh nghiÖm")
				SetTask(DATAU_PHANTHUONG3,0)		
		elseif i == 4 then
				SetTask(DATAU_LANHUY,GetTask(DATAU_LANHUY)+1)	
				Msg2Player("B¹n nhËn ®­îc 1 lÇn c¬ héi hñy bá nhiÖm vô  !")
		end
		SetTask(DATAU_DIEMNV,0)
		SetTask(DATAU_DATCUOC,0)
		SetTask(DATAU_LOAINV,0)
		SetTask(DATAU_BANDO,0)
		SetTask(DATAU_SOLAN,GetTask(DATAU_SOLAN)+1)
		if GetTask(DATAU_20NV) >= 100 and GetTask(DATAU_SOLAN) < 30 then
			SetTask(DATAU_20NV,1)
		else
			SetTask(DATAU_20NV,GetTask(DATAU_20NV)+1) -- Tang phan thuogn trong ngay
		end	
		--SetTask(DATAU_LIENTIEP,GetTask(DATAU_LIENTIEP) + 1) -- Tang phan thuoc Moc 100, 200 ,...

 		SetTask(2,0)
		SetTask(3,0)
		Talk(0,"")
	else
		Talk(1,"","Hack ha em")
	end	
end
function phanthuong(nid)
AddEventItem(44)
Msg2Player("B¹n nhËn ®­îc <color=green>HuyÒn Tinh 1")

if GetTask(DATAU_GIAIDOAN) == 3 then
	nl = GetTask(DATAU_GIAIDOAN)
	SetTask(DATAU_GIAIDOAN,GetTask(DATAU_GIAIDOAN)-3)
	if GetTask(DATAU_GIAIDOAN) == nl-3 then
		if (nid == 1) then
			Win_Exp()
		elseif (nid == 2) then
			SetTask(DATAU_LANHUY,GetTask(DATAU_LANHUY)+1)	
			Msg2Player("B¹n nhËn ®­îc 1 lÇn c¬ héi hñy bá nhiÖm vô  !")
		elseif (nid == 3) then
			Win_Item()
		elseif (nid == 4) then
				xs2 = RandomNew(1,3)
				if xs2 == 1 then
					Win_Exp()
				elseif xs2 == 2 then
					Win_Gold()
				elseif xs2 == 3 then
					Win_Item()
				end	
			
		elseif (nid == 5) then
			Win_Gold()
		end
		SetTask(DATAU_DIEMNV,0)
		SetTask(DATAU_DATCUOC,0)
		SetTask(DATAU_LOAINV,0)
		SetTask(DATAU_BANDO,0)
		SetTask(DATAU_SOLAN,GetTask(DATAU_SOLAN)+1)
		if GetTask(DATAU_20NV) >= 100 and GetTask(DATAU_SOLAN) < 30 then
			SetTask(DATAU_20NV,1)
		else
			SetTask(DATAU_20NV,GetTask(DATAU_20NV)+1)
		end	
		SetTask(2,0)
		SetTask(3,0)
		Talk(0,"")
	else
		Talk(1,"","Hack ha em")
	end
end
end

function hoangkim()
item = RandomNew(1,230)
if item == 1 then
AddItem(0,3,3,1,0,0,0)
Msg2SubWorld("Chóc mõng ["..GetName().."] hoµn thµnh NhiÖm vô D· TÈu H¹ng nhËn ®­îc [An Bang Cóc Hoa Th¹ch ChØ Hoµn]")
elseif item == 2 then
AddItem(0,3,4,1,0,0,0)
Msg2SubWorld("Chóc mõng ["..GetName().."] hoµn thµnh NhiÖm vô D· TÈu H¹ng nhËn ®­îc [An Bang Kª HuyÕt Th¹ch Giíi ChØ]")
elseif item == 3 then
AddItem(0,9,3,1,0,0,0)
Msg2SubWorld("Chóc mõng ["..GetName().."] hoµn thµnh NhiÖm vô D· TÈu H¹ng nhËn ®­îc [An Bang §iÒn Hoµng Th¹ch Ngäc Béi]")
elseif item == 4 or item == 11 or item == 17 then
AddItem(0,3,6,1,0,0,0)
Msg2SubWorld("Chóc mõng ["..GetName().."] hoµn thµnh NhiÖm vô D· TÈu H¹ng nhËn ®­îc [HiÖp Cèt §an T©m Giíi]")
elseif item == 5 or item == 12 or item == 18 then
AddItem(0,3,5,1,0,0,0)
Msg2SubWorld("Chóc mõng ["..GetName().."] hoµn thµnh NhiÖm vô D· TÈu H¹ng nhËn ®­îc [Nhu T×nh Phông Nghi Giíi ChØ]")
elseif item == 14 or item == 15 or item == 19 then
AddItem(0,9,4,1,0,0,0)
Msg2SubWorld("Chóc mõng ["..GetName().."] hoµn thµnh NhiÖm vô D· TÈu H¹ng nhËn ®­îc [HiÖp Cèt T×nh ý KÕt]")
elseif item == 6 or item == 13 or item == 20 then
AddItem(0,9,5,1,0,0,0)
Msg2SubWorld("Chóc mõng ["..GetName().."] hoµn thµnh NhiÖm vô D· TÈu H¹ng nhËn ®­îc [Nhu T×nh TuÖ T©m Ngäc Béi]")
elseif item == 7 or item == 16 or item == 21 then
AddItem(0,9,5,1,0,0,0)
Msg2SubWorld("Chóc mõng ["..GetName().."] hoµn thµnh NhiÖm vô D· TÈu H¹ng nhËn ®­îc [Nhu T×nh TuÖ T©m Ngäc Béi]")
elseif item == 8 then
AddItem(0,7,15,1,0,0,0)
Msg2SubWorld("Chóc mõng ["..GetName().."] hoµn thµnh NhiÖm vô D· TÈu H¹ng nhËn ®­îc [§Þnh Quèc ¤ Sa Ph¸t Qu¸n]")
elseif item == 9 or item == 22 then
AddItem(0,8,3,1,0,0,0)
Msg2SubWorld("Chóc mõng ["..GetName().."] hoµn thµnh NhiÖm vô D· TÈu H¹ng nhËn ®­îc [§Þnh Quèc Tö §»ng Hé UyÓn]")
elseif item == 10 or item == 23 then
AddItem(0,5,5,1,0,0,0)
Msg2SubWorld("Chóc mõng ["..GetName().."] hoµn thµnh NhiÖm vô D· TÈu H¹ng nhËn ®­îc [§Þnh Quèc XÝch QuyÒn NhuyÔn Ngoa]")
else
	rnd = RandomNew(1,9)
	if rnd == 1 then
	AddItem(0,6,2,1,0,0,0)
	elseif rnd == 2 then
	AddItem(0,5,4,1,0,0,0)
	elseif rnd == 3 then
	AddItem(0,9,2,1,0,0,0)
	elseif rnd == 4 then
	AddItem(0,7,14,1,0,0,0)
	elseif rnd == 5 then
	AddItem(0,2,29,1,0,0,0)
	elseif rnd == 6 then
	AddItem(0,8,2,1,0,0,0)
	elseif rnd == 7 then
	AddItem(0,4,2,1,0,0,0)
	elseif rnd == 8 then
	AddItem(0,3,1,1,0,0,0)
	else 
	AddItem(0,3,2,1,0,0,0)
	end
	Msg2SubWorld("Chóc mõng ["..GetName().."] hoµn thµnh NhiÖm vô D· TÈu H¹ng nhËn ®­îc Trang bÞ Kim Phong")
end
end



function tinh_exp_dc()
if GetLevel() >= 100 then
return 11
else
return floor(GetLevel()/10)+1
end
end

function tinh_exp_soluong()
if GetLevel() <= 30 then
return 2
elseif GetLevel() >= 30 and GetLevel() <= 59  then
return 4
elseif GetLevel() >= 60 and GetLevel() <= 79 then
return 6
elseif GetLevel() >= 80 and GetLevel() <= 119 then
return 9
else
return 12
end
end

function Win_Exp()
if tinh_exp_dc() < 1 or tinh_exp_dc() > getn(Mang_Exp2) then
Msg2Player("Lien he GM de bao loi. Loi nhan exp: "..tinh_exp_dc().." ")
print("Lien he GM de bao loi. Loi nhan exp: "..tinh_exp_dc().." ")
return
end
diem2 = 1
diemexp = 5 * tinh_exp_soluong() * Mang_Exp2[tinh_exp_dc()]
if GetTask(DATAU_LOAINV) == 1 then
	if GetTask(DATAU_BANDO) < 1 or GetTask(DATAU_BANDO) > getn(DoChi_Map) then
	SetTask(DATAU_BANDO,11)
	end
	diem2 = diemexp
elseif GetTask(DATAU_LOAINV) == 2 then
	if GetTask(DATAU_BANDO) < 1 or GetTask(DATAU_BANDO) > getn(DoChi_Map) then
	SetTask(DATAU_BANDO,11)
	end
	if GetTask(DATAU_DIEMNV) == 1 then
	diem2 = diemexp * 4 -- Gap 4 lan Do Chi
	elseif GetTask(DATAU_DIEMNV) == 2 then
	diem2 = diemexp * 5 -- Gap 4 lan Do Chi
	elseif GetTask(DATAU_DIEMNV) == 3 then
	diem2 = diemexp * 6 -- Gap 4 lan Do Chi
	else
	diem2 = diemexp * 4
	end
elseif GetTask(DATAU_LOAINV) == 3 then
	diem2 = diemexp / 3 
elseif GetTask(DATAU_LOAINV) == 4 or GetTask(DATAU_LOAINV) ==  6 then
	diem2 = diemexp * 2
elseif GetTask(DATAU_LOAINV) == 5 then
	diem2 = diemexp * 2
elseif GetTask(DATAU_LOAINV) == 8 then
	diem2 = diemexp * 4
elseif GetTask(DATAU_LOAINV) == 9 then
	if GetTask(DATAU_BANDO) == 250000 then
		diem2 = diemexp / 3
	elseif GetTask(DATAU_BANDO) == 500000 then
		diem2 = diemexp / 2
	else
		diem2 = diemexp * 2 / 3
	end
elseif GetTask(DATAU_LOAINV) == 7 then
	if GetTask(DATAU_BANDO) == 1 or GetTask(DATAU_BANDO) == 4 then
		diem2 = diemexp / 4
	elseif GetTask(DATAU_BANDO) == 2 or GetTask(DATAU_BANDO) == 5 then
		diem2 = diemexp / 3
	elseif GetTask(DATAU_BANDO) == 3 or GetTask(DATAU_BANDO) == 6 then
		diem2 = diemexp / 2
	elseif GetTask(DATAU_BANDO) == 7 then
		diem2 = diemexp / 2
	elseif GetTask(DATAU_BANDO) == 8 then
		diem2 = diemexp 
	else
		diem2 = diemexp * 2
	end
else
	diem2 = 100000
end
diem3 = 0
diem4 = 0
diem2 = floor(diem2)
diem3 = diem2 - (diem2 * 10 / 100) 
diem4 = diem2 + (diem2 * 10 / 100) 

diemnhanduoc = floor(RandomNew(diem3,diem4))
if GetLevel() < 80 then
diemnhanduoc = diemnhanduoc * 5
elseif GetLevel() >= 80 and GetLevel() < 100 then
diemnhanduoc = diemnhanduoc * 2
end

return diemnhanduoc
end

function tinh_gold_soluong()
if GetLevel() >= 100 then
return 10
else
return floor(GetLevel()/10)+1
end
end

function Win_Gold()
if tinh_exp_dc() < 1 or tinh_exp_dc() > getn(Mang_Exp2) then
Msg2Player("Lien he GM de bao loi. Loi nhan gold: "..tinh_exp_dc().." ")
print("Lien he GM de bao loi. Loi nhan exp: "..tinh_exp_dc().." ")
return
end
diemexp = 20 * tinh_exp_soluong() * Mang_Gold2[tinh_exp_dc()] * 15 / 100
diem2 = 1
if GetTask(DATAU_LOAINV) == 1 then
	diem2 = diemexp
elseif GetTask(DATAU_LOAINV) == 2 then
	if GetTask(DATAU_DIEMNV) == 2 then
		diem2 = diemexp*5
	elseif GetTask(DATAU_DIEMNV) == 3 then
		diem2 = diemexp*6
	else
		diem2 = diemexp*4
	end
elseif GetTask(DATAU_LOAINV) == 3 then
	diem2 = diemexp / 3
elseif GetTask(DATAU_LOAINV) == 4 or GetTask(DATAU_LOAINV) ==  6 then
	diem2 = diemexp * 2
elseif GetTask(DATAU_LOAINV) == 5 then
	diem2 = diemexp * 7/4
elseif GetTask(DATAU_LOAINV) == 8 then -- Tri PK
		diem2 = diemexp * 4
elseif GetTask(DATAU_LOAINV) == 9 then -- Tri Exp
		diem2 = diemexp * 5/3
elseif GetTask(DATAU_LOAINV) == 7 then -- Tri Diem DV PD
		diem2 = diemexp * 4/3
else
	diem2 = 20000
end

diem2 = floor(diem2 / 5)
diem3 = diem2 - diem2 * 30 / 100
diem4 = diem2 + diem2 * 10 / 100
diem2 = floor(RandomNew(diem3,diem4))
return diem2
end

function Win_Item()
xs = RandomNew(1,100)	
if xs <= 75 then
	xs3 = RandomNew(1,3)
	if xs3 == 1 then
		AddEventItem(103)
		Msg2Player("B¹n nhËn ®­îc 1 Ngò Hoa Ngäc Lé Hoµn LÔ Bao")	
	elseif xs3 == 2 then
		AddEventItem(104)
		Msg2Player("B¹n nhËn ®­îc 1 Cöu ChuyÓn Hoµn Hån §an LÔ Bao")			
	else
		AddEventItem(105)
		Msg2Player("B¹n nhËn ®­îc 1 Thñ ¤ Hoµn ThÇn §an LÔ Bao")	
	
	end
elseif xs > 75 and xs <= 99 then
	xs2 = RandomNew(1,100)
	if xs2 <= 60 then
		AddEventItem(173)
		Msg2Player("B¹n nhËn ®­îc 1 b×nh Phóc Duyªn Lé ")
	elseif xs2 > 60 and xs2 <= 90 then
		AddEventItem(174)
		Msg2Player("B¹n nhËn ®­îc 1 b×nh Phóc Duyªn Lé ")
	elseif xs2 > 90 and xs2 < 100 then
		AddEventItem(175)
		Msg2Player("B¹n nhËn ®­îc 1 b×nh Phóc Duyªn Lé ")
	end
else
	xs3 = RandomNew(1,30) 
	if xs3 == 1 then
		AddEventItem(RandomNew(28,30))
		Msg2Player("B¹n nhËn  ®­îc 1 viªn Thñy Tinh")
		Msg2SubWorld("<color=yellow>Chóc mõng "..GetName().." hoµn thµnh nhiÖm vô D· TÈu nhËn ®­îc 1 Thñy Tinh !")
	elseif xs3 == 2 then
		AddEventItem(1)
		Msg2Player("B¹n nhËn  ®­îc 1 TÈy Tñy Kinh")
		Msg2SubWorld("<color=pink>Chóc mõng "..GetName().." hoµn thµnh nhiÖm vô D· TÈu nhËn ®­îc 1 TÈy Tñy Kinh !")
	elseif xs3 == 3 then
		AddEventItem(0)
		Msg2Player("B¹n nhËn  ®­îc 1 Vâ l©m mËt tÞch")
		Msg2SubWorld("<color=pink>Chóc mõng "..GetName().." hoµn thµnh nhiÖm vô D· TÈu nhËn ®­îc 1 Vâ L©m MËt TÞch !")
	elseif xs3 == 4 then
		AddEventItem(31)
		Msg2Player("B¹n nhËn  ®­îc 1 viªn Tinh Hång B¶o Th¹ch")
		Msg2SubWorld("<color=yellow>Chóc mõng "..GetName().." hoµn thµnh nhiÖm vô D· TÈu nhËn ®­îc 1 Tinh Hång B¶o Th¹ch !")
	elseif xs3 > 4 and xs3 < 16 then
		AddEventItem(113)
		Msg2Player("B¹n nhËn ®­îc 1 Tiªn Th¶o Lé !")
		Msg2SubWorld("<color=yellow>Chóc mõng "..GetName().." hoµn thµnh nhiÖm vô D· TÈu nhËn ®­îc 1 Tiªn Th¶o Lé !")
	
	else
		AddEventItem(114)
		Msg2Player("B¹n nhËn ®­îc 1 N÷ Nhi Hång !")
		Msg2SubWorld("<color=yellow>Chóc mõng "..GetName().." hoµn thµnh nhiÖm vô D· TÈu nhËn ®­îc 1 N÷ Nhi Hång !")
	end		
end
end




function tinhxacsuat()

if GetLevel() < 80 then
	sx = RandomNew(1,100)
	if sx < 40 then
		return 1
	elseif sx >= 40 and sx < 50 then
		return 3
	elseif sx >= 50 and sx < 65 then
		return 6 -- Tim Option
	elseif sx >= 65 and sx < 85 then
		return 4
	elseif sx >= 85 and sx < 95 then
		return 5
	else
		return 2
	end	
elseif GetLevel() >= 80 and GetLevel() < 91 then
	sx = RandomNew(1,100)
	if sx < 40 then
		return 1
	elseif sx >= 40 and sx < 50 then
		return 3
	elseif sx >= 50 and sx < 65 then
		return 6 -- Tim Option
	elseif sx >= 65 and sx < 85 then
		return 4
	elseif sx >= 85 and sx < 95 then
		return 5
	else
		return 2
	end
else
	sx = RandomNew(1,100)
	if sx < 50 then
		return 1
	elseif sx < 80 then
		return random(4,6)
	elseif sx < 90 then
		return 3
	elseif sx < 99 then
		return 7
	elseif sx < 100 then
		return 8
	else
		return 2
	end
end
end


function nhannv2()
ngay = tonumber(date("%d"))
gio = tonumber(date("%H"))
phut = tonumber(date("%M"))
time = gio * 60 + phut
if GetTask(136) == ngay then
	if (GetTask(DATAU_SOLAN) >= 20) then
	Talk(1,"","H«m nay ng­¬i ®· lµm ®ñ sè nhiÖm vô ta yªu cÇu, ngµy mai h·y quay l¹i nhÐ !")
	return
	end
else
	SetTask(NGAY1,ngay)
	SetTask(SOLUONG_GIOIHAN,0)
	SetTask(DATAU_SOLAN,0)
	SetTask(9,0)
	SetTask(2,0)
	SetTask(3,0)
end

if GetTask(3) > 0 then
if time < GetTask(3) then
	Msg2Player(" "..time.." "..GetTask(3).." ")
	Talk(1,"","<color=green>D· TÈu: <color>: Ng­¬i ®· hñy nhiÖm vô liªn tôc <color=red>3<color> lÇn, hÖ thèng cÊm lµm nhiÖm vô 1 giê, h·y quay l¹i sau nhÐ !")
	return
else
	SetTask(3,0)
	SetTask(2,0)	
end
end

nl = GetTask(DATAU_GIAIDOAN)
SetTask(DATAU_GIAIDOAN,GetTask(DATAU_GIAIDOAN)+1)
if GetTask(DATAU_GIAIDOAN) == (nl+1) then
	loainv = tinhxacsuat()
	
	SetTask(DATAU_LOAINV,loainv)
	if (loainv == 1) then
		SetTask(DATAU_DIEMNV,soluongdochi())
		SetTask(DATAU_DATCUOC,0)
		SetTask(DATAU_BANDO,mapdochi())
	elseif (loainv == 2) then
		SetTask(DATAU_DIEMNV,soluongmatchi())
		SetTask(DATAU_DATCUOC,0)
		SetTask(DATAU_BANDO,mapdochi())
	elseif (loainv == 3) then
		SetTask(DATAU_BANDO,RandomNew(1,getn(Mua_Shop)))
	elseif (loainv == 4) then	
			SetTask(DATAU_BANDO,RandomNew(1,75))
	elseif (loainv == 5) then
		SetTask(DATAU_BANDO,RandomNew(1,getn(Option)))
	elseif (loainv == 6) then
		SetTask(DATAU_BANDO,RandomNew(1,getn(Item_Option)))
		if GetTask(DATAU_BANDO) <= 5 then
			SetTask(DATAU_DIEMNV,RandomNew(1,8))
		elseif GetTask(DATAU_BANDO) > 5 and GetTask(DATAU_BANDO) <= 10 then
			SetTask(DATAU_DIEMNV,RandomNew(1,14))
		else
			SetTask(DATAU_DIEMNV,RandomNew(1,getn(Item_Option2)))
		end
	elseif (loainv == 7) then
		SetTask(DATAU_BANDO,RandomNew(1,getn(Tri_Diem)))
		SetTask(DATAU_DIEMNV,GetTask(Tri_Diem[GetTask(DATAU_BANDO)][2])+Tri_Diem[GetTask(DATAU_BANDO)][3])
		SetTask(DATAU_DATCUOC,GetTask(Tri_Diem[GetTask(DATAU_BANDO)][2]))
	elseif (loainv == 8) then

		SetTask(DATAU_BANDO,1)

		SetTask(DATAU_DIEMNV,GetPK()+GetTask(DATAU_BANDO))
		SetTask(DATAU_DATCUOC,GetPK())
	elseif (loainv == 9) then
		kn = GetLevelExp()
		if GetLevel() < 10 then
			SetTask(DATAU_BANDO,5000)
		elseif GetLevel() >= 10 and GetLevel() < 30 then
			SetTask(DATAU_BANDO,20000)
		elseif GetLevel() >= 30 and GetLevel() < 50 then
			SetTask(DATAU_BANDO,50000)	
		else
			SetTask(DATAU_BANDO,Mang_KN[RandomNew(1,getn(Mang_KN))])
		end
		if (kn - (GetTask(DATAU_BANDO)+GetExp()) > 0) then
			SetTask(DATAU_DIEMNV,GetExp()+GetTask(DATAU_BANDO))
			SetTask(DATAU_DATCUOC,GetExp())
			SetTask(DATAU_KINHNGHIEM1,1)
		else
			SetTask(DATAU_KINHNGHIEM1,2)
			knlv1 = GetLevelExp() - GetExp()	
			knlv2 = GetTask(DATAU_BANDO) - knlv1
			SetTask(DATAU_DIEMNV,knlv2)
			SetTask(DATAU_DATCUOC,GetLevel()+1)			
		end
	end
	main()
end
end

function giaonhiemvu()
if GetTask(DATAU_LOAINV) == 3 then
OpenCheckItemBox("Hßm KiÓm Tra Item","H·y ®Æt vµo ®©y "..Mua_Shop[GetTask(DATAU_BANDO)][3].." [CÊp "..Mua_Shop[GetTask(DATAU_BANDO)][6].."] ®· mua ®­îc","ok")
elseif GetTask(DATAU_LOAINV) == 4 then
OpenCheckItemBox("Hßm KiÓm Tra Item","H·y ®Æt vµo ®©y "..TrangSuc_Ten[GetTask(DATAU_BANDO)][1].." ®· t×m ®­îc","ok")
elseif GetTask(DATAU_LOAINV) == 5 then
OpenCheckItemBox("Hßm KiÓm Tra Item","H·y ®Æt vµo ®©y 1 trang bÞ cã "..Option[GetTask(DATAU_BANDO)][1].." tõ "..Option[GetTask(DATAU_BANDO)][3].." ®Õn "..Option[GetTask(DATAU_BANDO)][4].." ®· t×m ®­îc","ok")
elseif GetTask(DATAU_LOAINV) == 6 then
OpenCheckItemBox("Hßm KiÓm Tra Item","H·y ®Æt vµo ®©y 1 trang bÞ "..Item_Option[GetTask(DATAU_BANDO)][1].." cã "..Item_Option2[GetTask(DATAU_DIEMNV)][1].." ®· t×m ®­îc","ok")
end
end


function ok()
idx = GetIdxItemBox ()
if (idx == -1) then
Msg2Player("Trong r­¬ng cã nhiÒu h¬n 1 vËt phÈm ")
elseif (idx == 0) then
Msg2Player("Trong r­¬ng kh«ng cã vËt phÈm nµo ")
elseif (idx == -2) then
Msg2Player("VËt phÈm ®Æt  vµo kh«ng ph¶i lµ trang bÞ ")
elseif (idx == -3) then
Msg2Player("Trang bÞ ®Æt vµo ®· bÞ khãa b¶o hiÓm ")
else
if GetTask(DATAU_LOAINV) == 3 then
	if GetDetailTypeItem(idx) == Mua_Shop[GetTask(DATAU_BANDO)][4] and GetParticularItem(idx) == Mua_Shop[GetTask(DATAU_BANDO)][5] and GetLevelItem(idx) == Mua_Shop[GetTask(DATAU_BANDO)][6] then
	DelEquipIdx(idx)
	if GetIdxItemBox() == 0 then
		nl = GetTask(DATAU_GIAIDOAN)
		SetTask(DATAU_GIAIDOAN,GetTask(DATAU_GIAIDOAN) + 1)
		if GetTask(DATAU_GIAIDOAN) == nl+1 then
			nl2 = GetTask(DATAU_LIENTIEP)
			SetTask(DATAU_LIENTIEP,GetTask(DATAU_LIENTIEP)+1)
			if GetTask(DATAU_LIENTIEP) == nl2+1 then
				hoanthanh()
				Talk(0,"")
			else
				Talk(1,"","Hack ha em")
			end
		else 
			Talk(1,"","Hack ha em")
		end
	else 
		Talk(1,"","Hack ha em")
	end
	else 
	Talk(1,"","Trang bÞ ®Æt vµo kh«ng ph¶i lµ <color=yellow>"..Mua_Shop[GetTask(DATAU_BANDO)][3].." [CÊp "..Mua_Shop[GetTask(DATAU_BANDO)][6].."]<color> ")
	end
elseif GetTask(DATAU_LOAINV) == 4 then
	if GetDetailTypeItem(idx) == TrangSuc_Ten[GetTask(DATAU_BANDO)][2] and GetParticularItem(idx) == TrangSuc_Ten[GetTask(DATAU_BANDO)][3] and GetLevelItem(idx) == TrangSuc_Ten[GetTask(DATAU_BANDO)][4] and GetSeriItem(idx) == TrangSuc_Ten[GetTask(DATAU_BANDO)][5] then
	DelEquipIdx(idx)
	if GetIdxItemBox() == 0 then
		nl = GetTask(DATAU_GIAIDOAN)
		SetTask(DATAU_GIAIDOAN,GetTask(DATAU_GIAIDOAN) + 1)
		if GetTask(DATAU_GIAIDOAN) == nl+1 then
			nl2 = GetTask(DATAU_LIENTIEP)
			SetTask(DATAU_LIENTIEP,GetTask(DATAU_LIENTIEP)+1)
			if GetTask(DATAU_LIENTIEP) == nl2+1 then
				hoanthanh()
				Talk(0,"")
			else
				Talk(1,"","Hack ha em")
			end
		else 
			Talk(1,"","Hack ha em")
		end
	else 
		Talk(1,"","Hack ha em")
	end
	else 
	Talk(1,"","Trang bÞ ®Æt vµo kh«ng ph¶i lµ <color=yellow>"..TrangSuc_Ten[GetTask(DATAU_BANDO)][1].."<color> ")
	end
elseif GetTask(DATAU_LOAINV) == 5 then
	if CheckMagicItem(idx,Option[GetTask(DATAU_BANDO)][2],Option[GetTask(DATAU_BANDO)][3],Option[GetTask(DATAU_BANDO)][4]) == 1 then
	DelEquipIdx(idx)
	if GetIdxItemBox() == 0 then
		nl = GetTask(DATAU_GIAIDOAN)
		SetTask(DATAU_GIAIDOAN,GetTask(DATAU_GIAIDOAN) + 1)
		if GetTask(DATAU_GIAIDOAN) == nl+1 then
			nl2 = GetTask(DATAU_LIENTIEP)
			SetTask(DATAU_LIENTIEP,GetTask(DATAU_LIENTIEP)+1)
			if GetTask(DATAU_LIENTIEP) == nl2+1 then
				hoanthanh()
				Talk(0,"")
			else
				Talk(1,"","Hack ha em")
			end
		else 
			Talk(1,"","Hack ha em")
		end
	else 
		Talk(1,"","Hack ha em")
	end
	else 
	Talk(1,"","Trang bÞ ®Æt vµo kh«ng cã <color=yellow>"..Option[GetTask(DATAU_BANDO)][1].."<color> tõ <color=red>"..Option[GetTask(DATAU_BANDO)][3].."<color> ®Õn <color=red>"..Option[GetTask(DATAU_BANDO)][4].."")
	end
elseif GetTask(DATAU_LOAINV) == 6 then
	if CheckMagicItem(idx,Item_Option2[GetTask(DATAU_DIEMNV)][2],1,200) == 1 and GetDetailTypeItem(idx) == Item_Option[GetTask(DATAU_BANDO)][2] and GetParticularItem(idx) == Item_Option[GetTask(DATAU_BANDO)][3] and GetLevelItem(idx) == Item_Option[GetTask(DATAU_BANDO)][4] then
	DelEquipIdx(idx)
	if GetIdxItemBox() == 0 then
		nl = GetTask(DATAU_GIAIDOAN)
		SetTask(DATAU_GIAIDOAN,GetTask(DATAU_GIAIDOAN) + 1)
		if GetTask(DATAU_GIAIDOAN) == nl+1 then
			nl2 = GetTask(DATAU_LIENTIEP)
			SetTask(DATAU_LIENTIEP,GetTask(DATAU_LIENTIEP)+1)
			if GetTask(DATAU_LIENTIEP) == nl2+1 then
				hoanthanh()
				Talk(0,"")
			else
				Talk(1,"","Hack ha em")
			end
		else 
			Talk(1,"","Hack ha em")
		end
	else 
		Talk(1,"","Hack ha em")
	end
	else 
	Talk(1,"","Trang bÞ ®Æt vµo kh«ng ph¶i lµ <color=yellow>"..Item_Option[GetTask(DATAU_BANDO)][1].."<color> cã <color=red>"..Item_Option2[GetTask(DATAU_DIEMNV)][1].."")
	end
end
end
end

-- NHIEM VU THAN BI DO CHI
function soluongdochi()
lv = GetLevel()
if lv < 30 then
return 3
elseif lv >= 30 and lv < 60 then
return 6
elseif lv >= 60 and lv < 80 then
return 9
elseif lv >= 80 and lv < 120 then
return 12
else
return 15
end
end

function soluongmatchi()
lv = GetLevel()
if lv < 40 then
return 1
elseif lv >= 40 and lv < 90 then
return RandomNew(1,2)
else
return RandomNew(1,3)
end
end

function mapdochi()
lv = floor(GetLevel()/10)+1
if GetLevel() < 10 then
return RandomNew(1,3)
elseif GetLevel() >= 10 and GetLevel() < 20 then
return RandomNew(4,9)
elseif GetLevel() >= 20 and GetLevel() < 30 then
return RandomNew(10,12)
elseif GetLevel() >= 30 and GetLevel() < 40 then
return RandomNew(13,15)
elseif GetLevel() >= 40 and GetLevel() < 50 then
return RandomNew(16,18)
elseif GetLevel() >= 50 and GetLevel() < 60 then
return RandomNew(19,21)
elseif GetLevel() >= 60 and GetLevel() < 70 then
return RandomNew(22,24)
elseif GetLevel() >= 70 and GetLevel() < 80 then
return RandomNew(25,27)
elseif GetLevel() >= 80 and GetLevel() < 90 then
return RandomNew(28,30)
else
return RandomNew(31,34)
end
end

function huy()
if GetTask(DATAU_LANHUY) == 0 then
	SayNew("<color=green>D· TÈu: <color>: HiÖn t¹i b¹n kh«ng cã c¬ héi nµo ®Ó hñy bá nhiÖm vô, b¹n chØ cã thÓ lµm l¹i tõ ®Çu th«i ! ",3,
	"§óng, ta kh«ng muèn lµm nhiÖm vô quû qu¸i nµy ®©u /huynv1",
	"Ta muèn sö dông 100 m¶nh S¬n Hµ X· T¾c ®Ó hñy bá nhiÖm vô lÇn nµy /huynv2",
	"Uhm! §Ó ta suy nghÜ l¹i ®· /no")
else
	SayNew("<color=green>D· TÈu: <color>: HiÖn t¹i b¹n vÉn cßn <color=yellow>"..GetTask(DATAU_LANHUY).."<color> c¬ héi hñy bá nhiÖm vô, sè ®iÓm tÝch lòy vÉn ®­îc gi÷ nguyªn. ",2,
	"§óng, ta kh«ng muèn lµm nhiÖm vô quû qu¸i nµy ®©u /huynv3",
	"Ta sÏ cè g¾ng lµm tiÕp nhiÖm vô nµy /no")
end
end

function huynv1()
thoigian = tonumber(date("%H%M%d%m"))
LoginLog = openfile("Data/HuyNhiemVuDaTau.txt", "a");
if LoginLog then
write(LoginLog,"[1] "..GetAccount().." - "..GetName().." - "..GetTask(DATAU_LIENTIEP).."  - Time: "..thoigian.."\n");
end
closefile(LoginLog)

SetTask(DATAU_GIAIDOAN,0)
SetTask(DATAU_DIEMNV,0)
SetTask(DATAU_DATCUOC,0)
SetTask(DATAU_LOAINV,0)
SetTask(DATAU_BANDO,0)
SetTask(DATAU_LIENTIEP,0)
SetTask(MOCPHANTHUONG,0)
SetTask(DATAU_SOLAN,GetTask(DATAU_SOLAN)+1)
Msg2Player("B¹n ®· hñy nhiÖm vô thµnh c«ng, sè lÇn hoµn thµnh nhiÖm vô liªn tiÕp hiÖn t¹i lµ 0")


SetTask(2,GetTask(2) + 1)
Msg2Player("B¹n ®· hñy "..GetTask(2).." liªn tôc. NÕu b¹n hñy 3 lÇn liªn tôc, sÏ kh«ng thÓ lµm d· tÈu sau 1 giê n÷a !")
if GetTask(2) >= 3 then
time = gio * 60 + phut + 60
SetTask(3,time)
Msg2Player("B¹n ®· hñy nhiÖm vô liªn tôc 3 lÇn, vui lßng quay l¹i ®©y sau 1 giê n÷a !")
end
Talk(0,"")
end


function huynv2()
	SayNew("<color=green>B¹n §ang cã: "..GetTask(DATAU_SHXT).." m·nh SHXT ",2,
                        "§ång ý hñy 100 m·nh SHXT/huynv200",
                        "Tho¸t./no")
                    end

function huynv200()
nl = GetTask(DATAU_SHXT)
if GetTask(DATAU_SHXT) >= 100 then
	SetTask(DATAU_SHXT,GetTask(DATAU_SHXT)-100)
	if GetTask(DATAU_SHXT) == nl-100 then
		SetTask(DATAU_GIAIDOAN,0)
		SetTask(DATAU_DIEMNV,0)
		SetTask(DATAU_DATCUOC,0)
		SetTask(DATAU_LOAINV,0)
		SetTask(DATAU_BANDO,0)
		SetTask(DATAU_SOLAN,GetTask(DATAU_SOLAN)+1)
		Msg2Player("B¹n ®· sö dông 100 m·nh b¶n ®å S¬n Hµ X· T¾c vµ hñy nhiÖm vô thµnh c«ng !")
		Talk(0,"")
	else
		Talk(1,"","Hack ha em")
	end
else
	Talk(1,"","<color=green>D· TÈu: <color>: Ng­¬i kh«ng mang  ®ñ 100 tÊm b¶n ®å S¬n hµ X· t¾c, h·y ®i kiÕm ®ñ råi ta sÏ cho ng­¬i hñy bá nhiÖm vô nµy ")
end
end

function huynv3()
nl = GetTask(DATAU_LANHUY)
if GetTask(DATAU_LANHUY) >0 then
	SetTask(DATAU_LANHUY,GetTask(DATAU_LANHUY)-1)
	if GetTask(DATAU_LANHUY) == nl-1 then
		SetTask(DATAU_GIAIDOAN,0)
		SetTask(DATAU_DIEMNV,0)
		SetTask(DATAU_DATCUOC,0)
		SetTask(DATAU_LOAINV,0)
		SetTask(DATAU_BANDO,0)
		SetTask(DATAU_SOLAN,GetTask(DATAU_SOLAN)+1)
		Msg2Player("B¹n ®· sö dông c¬ héi hñy bá nhiÖm vô cña D· TÈu vµ hñy nhiÖm vô thµnh c«ng !")
		Talk(0,"")
	else
		Talk(1,"","Hack ha em")
	end
else
	Talk(1,"","Hack ha em")
end
end




function no()
end


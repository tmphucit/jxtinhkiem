--MissionV 0	dwID cua doi truong
--MissionV 1	so luong con quai' duoc add
--GlbMissV 0 -> 10 co nguoi dang ky hay chua?
MAP_VUOTAI = {
480,
481,
482,
483,
484,
485,
486,
487,
488,
489
};

THANHTHI_RETURN={
{1  ,1510,3188},
{11 ,3214,4986},
{162,1587,3228},
{37 ,1638,3051},
{78 ,1514,3216},
{80 ,1697,2950},
{176,1372,2996}
};

VUOTAI_POS = {
[1]={
	{49510,103290},
    {49872,103652},
    {49681,103116},
    {50040,103468},
    {49858,102940},
    {50209,103308},
    {50032,102772},
    {50386,103136},
    {50198,102602},
    {50554,102978},
    {50374,102446},
    {50721,102788},
    {50222,103666},
    {50556,103320},
    {49672,102770}
},
[2]={
	{49510,103290},
    {49872,103652},
    {49681,103116},
    {50040,103468},
    {49858,102940},
    {50209,103308},
    {50032,102772},
    {50386,103136},
    {50198,102602},
    {50554,102978},
    {50374,102446},
    {50721,102788},
    {50222,103666},
    {50556,103320},
    {49672,102770},
	{50374,102786},
	{50035,103120},
	{49700,103478},
	{50898,102986},
	{50056,103838}
},
[3]={
	{49510,103290},
    {49872,103652},
    {49681,103116},
    {50040,103468},
    {49858,102940},
    {50209,103308},
    {50032,102772},
    {50386,103136},
    {50198,102602},
    {50554,102978},
    {50374,102446},
    {50721,102788},
    {50222,103666},
    {50556,103320},
    {49672,102770},
	{50374,102786},
	{50035,103120},
	{49700,103478},
	{50898,102986},
	{50056,103838},
	{49165,103288},
	{49832,104028},
	{50247,104374},
	{50422,104204},
	{50407,104534},
	{51259,103328},
	{51440,103494}
},
[4]={
	{49510,103290},
    {49681,103116},
    {49858,102940},
    {50032,102772},
    {50386,103136},
    {50554,102978},
    {50374,102446},
    {50222,103666},
    {49672,102770}
}
};

NPC_VUOTAI={
-----1------2---3-------4--------5--------------------------------6-7-8-9-10
	{1007,1,RANDOMC(0,1,2,3,4), 30000 ,{53  ,1,53  ,1,53  ,1,53  ,1},100,0,0,0,0	,0},          --1 
	{1008,1,0, 30000 ,{53	,1,53  ,1,53  ,1,424,1},100,0,0,0,0	,0},          --2 
	{1009,1,1, 30000 ,{425,1,425,1,425,1,425,1},0,50,0,0,0		,0},            --3 
	{1010,1,2, 30000 ,{426,1,426,1,426,1,426,1},0,0,100,0,0	,0},          --4 
	{1011,1,3, 30000 ,{427,1,427,1,427,1,427,1},0,0,0,105,0	,0},          --5 
	{1012,1,4, 30000 ,{428,1,428,1,428,1,428,1},0,0,0,0,110	,0},          --6 
	{1013,1,RANDOMC(0,1,2,3,4), 35000 ,{19  ,1,19  ,1,19  ,1,19  ,1},110,0,0,0,0	,1},        --7 
	{1014,2,0, 35000 ,{424,1,424,1,424,1,424,1},110,0,0,0,0	,0},            --8 
	{1015,2,1, 35000 ,{425,1,425,1,425,1,425,1},0,60,0,0,0		,2},            --9 
	{1016,2,2, 35000 ,{426,1,426,1,426,1,426,1},0,0,115,0,0	,0},            --10
	{1017,2,3, 35000 ,{427,1,427,1,427,1,427,1},0,0,0,120,0	,3},            --11
	{1018,2,4, 35000 ,{428,1,428,1,428,1,428,1},0,0,0,0,125	,0},          --12
	{1015,2,RANDOMC(0,1,2,3,4), 40000 ,{359,1,359,1,359,1,359,1},100,0,0,40,0	,4},          --13
	{1016,2,2, 40000 ,{426,1,426,1,426,1,426,1},0,0,140,0,0	,5},            --14
	{1017,2,3, 40000 ,{427,1,427,1,427,1,427,1},0,0,0,150,0	,6},            --15
	{1019,2,RANDOMC(0,1,2,3,4), 40000 ,{624,15,624,15,624,15,624,15},0,0,0,0,0	,0},          --16
	{1020,1,0, 40000 ,{627,10,627,10,627,10,627,10},160,0,0,0,0	,7},        --17
	{1011,3,RANDOMC(0,1,2,3,4), 40000 ,{357,1,357,1,357,1,357,1},0,0,0,170,0			,8},          --18
	{1021,1,4, 45000 ,{626,12,626,12,626,12,626,12},0,0,0,0,0		,0},          --19
	{1016,3,RANDOMC(0,1,2,3,4), 45000 ,{362,1,362,1,362,1,362,1},0,0,0,180,0			,9},          --20
	{1022,1,2, 45000 ,{628,15,628,15,628,15,628,15},0,0,150,0,0	,0},            --21
	{1010,3,RANDOMC(0,1,2,3,4), 45000 ,{165,1,165,1,165,1,165,1},0,0,0,0,200			,10},          --22
	{1023,1,3, 45000 ,{625,15,625,15,625,15,625,15},0,0,0,0,0		,0},            --23
	{1007,3,RANDOMC(0,1,2,3,4), 45000 ,{355,1,355,1,355,1,355,1},180,30,0,0,0			,11},          --24
	{1024,1,RANDOMC(0,1,2,3,4),50000  ,{53,1,53,1,53,1,53,1		 },600,0,0,0,0			,0},            --25
	{1018,3,RANDOMC(0,1,2,3,4),50000  ,{357,1,359,1,362,1,165,1},0,0,0,230,230		,12},          --26
	{1025,4,RANDOMC(0,1,2,3,4),50000  ,{0,0,0,0,0,0,0,0				 },0,0,0,0,0				,0}            --27
};

BOSS_VUOTAI={
	{1026,RANDOMC(0,1,2,3,4),{339,1,302,1,353,1,355,1},100,20,0,0,0		,"NguyÖt ¶nh"						},            --1 
	{1027,RANDOMC(0,1,2,3,4),{339,1,302,1,353,1,355,1},110,20,0,0,0		,"HuyÒn ¢m"						},            --2 
	{1036,RANDOMC(0,1,2,3,4),{339,1,302,1,353,1,355,1},120,20,0,0,0		,"U Hån"				},       --11
	{1031,4,{1078,20,1078,20,1078,20,1078,20},0,0,0,0,20		,"Tinh Hµ "			},            --6 
	{1028,0,{1058,20,1058,20,1058,20,1058,20},100,0,0,0,0		,"B¸t Hoang"		},            --3 
	{1029,3,{1074,20,1074,20,1074,20,1074,20},0,0,0,40,0		,"Lôc Long"			},            --4 
	{1030,4,{1080,20,1080,20,1080,20,1080,20},200,0,0,0,0		,"Cuång Phong"	},            --5 
	{1032,1,{339,1,302,1,353,1,355,1},130,25,0,0,0		,"Cµn Kh«n"		},            --7 
	{1033,0,{1055,20,1055,20,1055,20,1055,20},230,0,0,0,0		,"Vi §µ "				},            --8 
	{1034,2,{1063,20,1063,20,1063,20,1063,20},0,0,105,0,0		," "						},            --9 bangtuoc
	{1035,3,{362,20,362,20,362,20,362,20},0,0,0,25,0		,"TËt Háa"			},            --10
	{1037,RANDOMC(0,1,2,3,4),{339,1,302,1,353,1,355,1},150,30,0,0,0		," "							}            --12
};

VUOTAI_FILE_NORMAL="\\script\\feature\\vuotai\\die_normal.lua"
VUOTAI_FILE_BOSS="\\script\\feature\\vuotai\\die_boss.lua"
--nLevel la ai~ thu may
function release_npcvuotai(nLevel,nMap)
	local nNpcIdx;
	if(nLevel == 28) then	--boss cuoi cung
		nNpcIdx = AddNpcNew(1038,100,
		nMap,50201,102968,nil,nil,"§éc C« Quû KiÕm",nil,
		RANDOMC(0,1,2,3,4),0,1500000,nil,5000,200,1,1,1,nil,50,2,nil);
		if(nNpcIdx > 0) then
		AddMSNpc(1,nNpcIdx);
		SetNpcScript(nNpcIdx, VUOTAI_FILE_BOSS);
		end
		Msg2MSAll(1,"Qu¸i nh©n gi÷ ¶i cuèi cïng ®· xuÊt hiÖn!");
	else
	local nPos = NPC_VUOTAI[nLevel][2];
	local count = 0;
	for i=1,getn(VUOTAI_POS[nPos]) do
		nNpcIdx = AddNpcNew(NPC_VUOTAI[nLevel][1],100,
		nMap,VUOTAI_POS[nPos][i][1],VUOTAI_POS[nPos][i][2],nil,nil,nil,
		nil,NPC_VUOTAI[nLevel][3],0,50000+(nLevel*1000),nil,1000,150,1,1,1,nil,25,nil,nil);
		if(nNpcIdx > 0) then
		AddMSNpc(1,nNpcIdx);
		count = count + 1;
		SetNpcValue(nNpcIdx,nLevel);
		SetNpcScript(nNpcIdx, VUOTAI_FILE_NORMAL);
			if(nLevel == 27) then--phan don
			SetNpcSkill(nNpcIdx, 16, 25, 5);
			end
		end
	end
	local nBoss = NPC_VUOTAI[nLevel][11];
	if(nBoss > 0) then--ra boss
		local szName = BOSS_VUOTAI[nBoss][9];
		if(szName == " " ) then
			local nCount = GetMSPlayerCount(1);
			local check = 0;
			if(nCount > 0) then
				for i=1,nCount do
				if(GetPMParam(1, i, 0) == 1 and check == 0) then --dang online
				PlayerIndex = MSDIdx2PIdx(1, i);
				szName = GetName();
				check = 1;
				end
				end
			end
		end
		nNpcIdx = AddNpcNew(BOSS_VUOTAI[nBoss][1],100,
		nMap,50201,102968,nil,nil,szName,nil,
		BOSS_VUOTAI[nBoss][2],0,500000+(nBoss*20000),nil,2000,200,1,1,1,nil,40,2,nil);
		if(nNpcIdx > 0) then
		AddMSNpc(1,nNpcIdx);
		count = count + 1;
		SetNpcValue(nNpcIdx,nLevel);
		SetNpcScript(nNpcIdx, VUOTAI_FILE_NORMAL);
		end
	end
	SetMission(1,SetNumber(2,GetMissionV(1),1,count))		--so luong con quai'
	SetMission(1,SetNumber(2,GetMissionV(1),2,nLevel))		--ai thu
	Msg2MSAll(1,format("Vµo ¶i thø %d. XuÊt hiÖn %d con qu¸i.",nLevel, count));
	end
end;

Include("\\script\\Global\\doimaump.lua")
Include("\\script\\hoatdong\\daihoianhhung\\danhsachnhanthuong.lua")
Include("\\datascript\\liendau\\danhsachxephang.lua")
Include("\\datascript\\banghoi\\danhsachthanhthi.lua")
--Include("\\script\\chuyensinh\\dscs.lua")

Include("\\Script\\Global\\sourcejx49.lua")
Include("\\Script\\header\\taskid.lua");
Include("\\Script\\lib\\worldlibrary.lua");
Include("\\Script\\lib\\thuvien.lua");

DANH_SACH_LOGIN = {}

function main()
print(""..GetName().." vao game")

ngay = tonumber(date("%d"))
w,x,y = GetWorldPos()
--loginnum = login_checksoluong()
--if loginnum > 8 then
--	KickOutSelf()
--	print(""..GetName().." vuot qua gioi han 8 Account / IP")
--	return
--else
--	print(""..GetName().." Login: "..loginnum.." / 8 Account")
--end


if ((w == 53 or w == 1 or w == 15 or w == 19 or w == 15 or w == 18 or w == 20 or w == 15 or w == 2) and GetLevel() >= 1 and GetLevel() <= 150) then
	-- Msg2SubWorld("B¹n ®· ®­îc më khãa chat. Hi väng b¹n kh«ng t¸i ph¹m n÷a")
  --  Talk(1,"","<color=yellow>H§ H¸i Qu¶ : 13h00 vµ 19h00. T¹i Hoa S¬n vµ SM1<enter>H§ Boss TiÓu Hoµng Kim : 10h30, 15h30, 23h50.<enter>H§ Boss Server : 13h20 t¹i BLH vµ 21h00 t¹i SM1.<enter>H§ L«i §µi Hçn ChiÕn: 19h00 vµ 23h00")
    -- Talk(1,"","Ho¹t §éng Boss TiÓu Hoµng Kim : 8h30, 10h30, 15h30, 23h50.")
    -- Talk(1,"","Ho¹t §éng Boss Server : 13h20 t¹i BLH vµ 20h00 t¹i SM1.")
--    Talk(1,"","<color=yellow>H§ Boss §¹i Hoµng Kim :15h30, 18h30, 23h30.<enter>H§ Phong L¨ng §é : C¸c giê Ch½n trong ngµy.<enter>H§ Boss Phong L¨ng §é : 22h40.<enter>H§ Liªn §Êu : B¾t ®Çu tõ 08/07 - 28/07<enter><color=green>Chóc ae mät ngµy tèt lµnh!!")
    -- Talk(1,"","Ho¹t §éng Phong L¨ng §é : C¸c giê Ch½n trong ngµy. Mçi ngµy 1 nh©n vËt ®­îc tham gia 2 lÇn.")
    -- Talk(1,"","Ho¹t §éng Boss Phong L¨ng §é : 22h40.")
 
    -- Talk(1,"",".Ra bªn thuyÒn Ba L¨ng HuyÖn lªn §µo Hoa §¶o ®Ó tham ®¨ng ký Tham Gia.")
    -- Talk(1,"","Ho¹t §éng Liªn §Êu : B¾t ®Çu tõ 08/07 - 28/07")
end

if w == 4 and GetTask(534) == 0 and GetLevel() == 1 then
	SetTask(534,100)
end

if GetTask(534) == 100 and GetLevel() ~= nil then
		if GetTask(536) ~= 100 then
				SetTask(536,100)
				NewWorld(4, 200*8, 200*16)
				SetRevPos(41)
				if GetLevel() >= 130 then
						SetLevel(130)
						KickOutSelf()
						return
				end	
		end
end


if GetTask(534) == 0 then
	if GetTask(520) == 0 then
		if GetLevel() == 1 then
			SetTask(520, 200)
		else	
			for i=1,GetItemCount2(22) do
				DelAllItem(22)
			end
			SetTask(520, 100)
		end
	end


	if GetTask(532) == 0 then
		SetTask(532, GetTask(100))
		if GetTask(100) == 0 then
			SetTask(532,1)
		end
	end


	if GetTask(533) ~= 200 then
			SetTask(533,200)
			if GetTask(529) == ngay then
				SetTask(530, 16)
				SetTask(531, 2000000)
			end
	end


	if GetTask(522) == 0 then
		SetTask(522,100)
		if GetLevel() > 120 then
				SetTask(523, GetLevel() - 120)
				SetTask(524, GetExp())
		elseif GetLevel() == 120 and GetExp() > 0 then
				SetTask(523, 0)
				SetTask(524, GetExp())
		end
		
		i = random(1,10)
		if i == 1 then
		NewWorld(53,1608,3207)
		elseif i == 2 then
		NewWorld(53,1624,3193)
		elseif i == 3 then
		NewWorld(53,1617,3176)
		elseif i == 4 then
		NewWorld(53,1592,3173)
		elseif i == 5 then
		NewWorld(53,1577,3157)
		elseif i == 6 then
		NewWorld(53,1550,3140)
		elseif i == 7 then
		NewWorld(53,1526,3185)
		elseif i == 8 then
		NewWorld(53,1556,3178)
		elseif i == 9 then
		NewWorld(53,1594,3223)
		else
		NewWorld(53,1638,3226)
		end
		
	end

	if GetTask(525) == 0 and GetTask(522) == 100 then  --XAC NHAN PHUC HOI VO LLMT TTK
		SetTask(525,100)
		AddProp(GetTask(198)*5)
		AddMagicPoint(GetTask(199))
		tinhexp = GetTask(523) * 60000000 + floor(GetTask(524)/10)
		SetTask(526, tinhexp)
		--Msg2SubWorld("Debug: "..GetName().." - "..GetTask(523).." - "..GetTask(524).." - "..GetTask(526).." - "..tinhexp.."")
	end
end

if w == 239 then
	SetFightState(0)
	BlockPKState(0)
	SetPunish(0);
	SetCreateTeam(1);
	SetDeathScript("");
	SetCurCamp(GetCamp())
end

if w == 24 then -- VI SON DAO
	SetPKState(1)
	BlockPKState(1)
	SetTempRevPos(24,1395*32,2783*32)
	SetRevPos(58)
	SetFightState(0)
	NewWorld(24,1395,2783)
end

if w == 5 or w == 189 then  -- Tu dong tinh tiep time ngoi tu
	if  GetTask(142) > 0 then
		SetTimer(18*60,21)
		SetTaskTemp(142,1)
		Talk(1,"","Thêi gian ®Ó gi¶m PK cßn l¹i: "..GetTask(142).." phót")
	else
		if GetPK() > 0 then
			truPK = GetPK()-1
			SetTaskTemp(142,1)  -- Task kiem tra dang su dung timer
			SetTask(142,60)  -- Tasktimer ngoi tu. Mac dinh: 60 phut
			Talk(1,"","Sau 1 giê n÷a b¹n sÏ gi¶m ®iÓm PK xuèng: "..truPK.." ®iÓm")
			SetTimer(18*60,21)
			Msg2Player("Thêi gian ngåi nhµ lao b¾t ®Çu !!!")
		else
			Talk(1,"","Thêi gian c¶i t¹o cña ng­¬i ®· kÕt thóc, h·y ra ngoµi vµ ®õng l¹m s¸t kÎ v« téi n÷a nhÐ ")
		end
	end
end

if w == 26 or w == 28 or w == 29 then -- VUOT AI
	SetFightState(0);
	SetRevPos(53,19)
	BlockPKState(0)
	Msg2Player("B¹n ®­îc ®­a vÒ Ba L¨ng HuyÖn")
	NewWorld(53, 1630, 3255);
elseif w == 42 then
	if GetTask(145) == 0 then
		SetFightState(0)
		SetCurCamp(GetTask(16))
		SetCamp(GetTask(16)) 
		SetDeathScript("")
		BlockPKState(0)
		SetRevPos(19)
		NewWorld(53,200*8,200*16)
	end
end



thoigian = tonumber(date("%H%M%d%m"))
LoginLog = openfile("Data/LogLogin.txt", "a");
if LoginLog then
write(LoginLog,"["..GetAccount().."] ["..GetName().."] ["..GetLevel().."] - IP: "..GetIP().." -  Time: "..thoigian.."\n");
end
closefile(LoginLog)


AddLeadExp(9999999999)
if GetItemCount(3) < 1 then

end

gio = tonumber(date("%H"))
for i=1,GetItemCount(176) do
DelItem(176)
end

if GetTask(119) == 1 then
SetTask(119,0)
SetFightState(1)
end

if GetTask(40) == 1 and w == 60 then
SetTask(40,0)
SetRank(GetTask(18))
SetCurCamp(GetTask(16))
SetCamp(GetTask(16)) 
SetPK(GetTask(17))
SetTask(128,0) 
SetTask(16,0)
SetTask(18,0)
SetTask(17,0)
SetPunish(0)
SetFightState(0)
SetCreateTeam(1);
SetLogoutRV(0);
SetPKState(0)
BlockPKState(0)
SetDeathScript("");
DelMagic(413)
end
---------------------------vßng s¸ng trªn cÊp 60 mÊt-------------
if GetLevel() >= 60 then            
AddSkillEffect(503,1,1*18)
end
----------------------------------------------------------------

vangtable = GetExtPoint(1)
if vangtable  > 0 then
	PayExtPoint(vangtable)
	if GetExtPoint(1) == 0 then
		slvang = GetTask(99)
		SetTask(99,GetTask(99) + vangtable)
		SetTask(101,GetTask(101) + vangtable)
		--SetTask(505, GetTask(505) + vangtable)
		if vangtable >= 100 and GetTask(506) ~= 666 then
			SetTask(506, GetTask(506) + vangtable)
			SetTask(507, GetTask(507) + vangtable)
			
		end
		if GetTask(99) ~= slvang + vangtable then
			thoigian = tonumber(date("%H%M%d%m"))
			LoginLog = openfile("Data/LogLoiNapVang.txt", "a");
			if LoginLog then
			write(LoginLog,"Tai khoan: ["..GetAccount().."] - Nhan vat: ["..GetName().."] - Vang: "..vangtable.." - Tong vang: "..GetTask(99).." - IP: "..GetIP().." -  Time: "..thoigian.."\n");
			end
			closefile(LoginLog)	
			SetTask(99,0)
			Talk(1,"","X¶y ra lçi hack vµng, liªn hÖ admin ®Ó gi¶i quyÕt")
			return
		end
		--vangkm = floor(vangtable/10)
		--SetTask(99,GetTask(99) + vangkm)
		--SetTask(101,GetTask(101) + vangkm)
		
		thoigian = tonumber(date("%H%M%d%m"))
		LoginLog = openfile("Data/LogNapVangNew.txt", "a");
		if LoginLog then
		write(LoginLog,"Tai khoan: ["..GetAccount().."] - Nhan vat: ["..GetName().."] - Vang: "..vangtable.." - Tong vang: "..GetTask(99).." - Vang Cu: "..slvang.." - IP: "..GetIP().." -  Time: "..thoigian.."\n");
		end
		closefile(LoginLog)
		
		LoginLog = openfile("Data/LogNapVangNew2.txt", "a");
		if LoginLog then
		write(LoginLog,"{["..GetAccount().."],["..GetName().."],"..vangtable.."},\n");
		end
		closefile(LoginLog)
	
		Talk(1,"","N¹p thÎ thµnh c«ng !!! NhËn ®­îc <color=green>"..vangtable.." vµng<color>")
		SetExtPoint(0,0)
		SaveData()
	else
		Talk(1,"","Hack ha em ")
	end
end


if GetTask(506) >= 260  then
SetTask(485,1)
SetTask(488,4)
SetTask(483,   240*60 * 18)
end
if GetTask(506) >= 700  then
SetTask(485,2)
SetTask(488,4)
SetTask(483,   240*60 * 18)
end
if GetTask(506) >= 1500  then
SetTask(485,3)
SetTask(488,4)
SetTask(483,   240*60 * 18)
end
if GetTask(506) >= 3000  then
SetTask(485,4)
SetTask(488,4)
SetTask(483,   240*60 * 18)
end
if GetTask(506) >= 5000  then
SetTask(485,5)
SetTask(488,3)
SetTask(483,   480*60 * 18)
end
if GetTask(506) >= 7000  then
SetTask(485,6)
SetTask(488,3)
SetTask(483,   480*60 * 18)
end
if GetTask(506) >= 10000  then
SetTask(485,7)
SetTask(488,5)
SetTask(483,   480*60 * 18)
end
if GetTask(506) >= 15000  then
SetTask(485,8)
SetTask(488,7)
SetTask(483,   480*60 * 18)
end
if GetTask(506) >= 20000  then
SetTask(485,9)
SetTask(488,7)
SetTask(483,   480*60 * 18)
end
if GetTask(506) >= 25000  then
SetTask(485,10)
SetTask(488,8)
SetTask(483,   480*60 * 18)
end



if GetTask(152) > 0 then
BlockBox(1)
else
BlockBox(0)
end

if GetTask(200) > 5 then
task = GetTask(200) - 5 
for i = 1,task do AddEventItem(19) end
end
if GetTask(200) > 5 then
SetTask(200, 5)
TayTiemNang()
end


idxaa = PlayerIndex


FixPlayer()
doimaump()
w,X,Y = GetWorldPos()
if GetTask(172) > 0 then
if GetTask(141) == 2 then
AddSkillEffect(456,1,GetTask(172))
else
AddSkillEffect(460,1,GetTask(172))
end
end

if GetTask(475) > 0 then
AddSkillEffect(455,1,GetTask(475))
end

if GetTask(163) == 1 then
AddSkillEffect(456,1,60*60*18)
end

if GetCurCamp() >= 5 or GetCamp() >= 5 then
doimaump()
Msg2Player("B¹n bÞ lçi mµu s¾c. Tù ®éng fix")
end

if GetTask(144) > 0 then
xemconlai()
end

AddMagic(53,1)
AddMagic(2,1)


-- if GetLevel() == 1 then
-- AddEventItem(176)
-- end

if GetTask(514) ~= 8888 then
	SetTask(514,8888)
	for k=610,615 do 
		for i=1,GetItemCount2(k) do
			DelAllItem(k)
		end
	end
	for k=193,195 do 
		for i=1,GetItemCount2(k) do
			DelAllItem(k)
		end
	end
	for k=578,578 do 
		for i=1,GetItemCount2(k) do
			DelAllItem(k)
		end
	end
	for k=362,362 do 
		for i=1,GetItemCount2(k) do
			DelAllItem(k)
		end
	end
end
if GetItemCount(20) < 1 then
	AddEventItem(20)
end
if GetTask(132) == 1 then
	SetTask(132,0)
end

if w == 22 or w == 2 or w == 56 or w == 67 or w == 54 or w == 70 or w == 57 or w == 68 or w == 74 or w == 92 or w == 73 or w == 8 or w == 41 or w == 13 or w == 91 or w == 38 or w == 14 or w == 50 or w == 39 or w == 62 or w == 78 or w == 102 or w == 63 or w == 104 or w == 64 or w == 65 or w == 21 or w == 107 or w == 109 or w == 110 then
SetFightState(1)
end

if GetTongName() == DSTT[1][4] and GetName() == DSTT[1][8] then
SetRank(239)
AddSkillEffect(495,1,99999999)
elseif GetTongName() == DSTT[2][4] and GetName() == DSTT[2][8] then
SetRank(239)
AddSkillEffect(495,1,99999999)
elseif GetTongName() == DSTT[3][4] and GetName() == DSTT[3][8] then
SetRank(239)
AddSkillEffect(495,1,99999999)
elseif GetTongName() == DSTT[4][4] and GetName() == DSTT[4][8] then
SetRank(239)
AddSkillEffect(495,1,99999999)
else
if HaveMagic(459) == 1 or HaveMagic(492) == 1 then
	DelMagic(459)
	DelMagic(492)
	SetRank(1)
end
end


if GetItemCount(20) < 1 then
	AddEventItem(20)
end

if HaveMagic(210) < 0 then
	AddMagic(210,1)
end
-- w,x,y = GetWorldPos()
-- if w == 64 then
-- NewWorld(53,200*8,200*16)
-- KickOutSelf()
-- return
-- end

CapNhatDanhHieuLienDau()
-- CapNhatDanhHieuLienDauNew()
--CapNhatVongSangAnhHung()
if GetTask(139) == 1 then
AddMagic(514,40)
end
if GetTask(139) == 2 then
DelMagic(514)
AddMagic(509,40)
end
if GetTask(139) == 3 then
DelMagic(509)
AddMagic(513,40)
end
if GetTask(200) > 100 then
SetTask(200,100)
end
if GetAccount() == "" then
SetTask(200,150)
end

end;

function login_checksoluong()
num = 0
idxp = PlayerIndex
ipman = GetIP()
for i=1,GetCountPlayerMax() do
PlayerIndex = i
	if GetName() ~= "" and GetLevel() ~= nil and GetLevel() ~= 0 and GetIP() ~= nil and ipman ~= nil then
		if split_new(ipman) == split_new(GetIP()) then
			num = num + 1
		end
	end
end

PlayerIndex = idxp
return num
end

function login_checkname()
if getn(DANH_SACH_LOGIN) == 0 then
return 0
end

for i=1,getn(DANH_SACH_LOGIN) do
	if DANH_SACH_LOGIN[i][1] == GetName() then
		return i
	end
end
return 0
end


function KhoiTaoDanhSachLogin()
DANH_SACH_LOGIN[getn(DANH_SACH_LOGIN)+1] = {GetName(),GetIP()}
end

function split_new(str)
	splitor=" :"
	local strArray={}
	local strStart=1
	local splitorLen = strlen(splitor)
	local index=strfind(str,splitor,strStart)
	if(index==nil) then
		strArray[1]=str
		return strArray[1]
	end
	local i=1
	while index do
		strArray[i]=strsub(str,strStart,index-1)
		i=i+1
		strStart=index+splitorLen
		index = strfind(str,splitor,strStart)
	end
	strArray[i]=strsub(str,strStart,strlen(str))
	return strArray[1]
end



function checkten()
for i=1,getn(server) do
	if server[i][2] == GetAccount() then
		return 1
	end
end
return 0
end

function CapNhatVongSangAnhHung()
if GetName() == "" or GetName() == "" or GetName() == "" then
SetRank(237)
AddSkillEffect(495,1,99999999)
elseif GetName() == "" or GetName() == "" or GetName() == "" then
SetRank(238)
AddSkillEffect(493,1,99999999)
end
end
function thoatno()
KickOutSelf()
end

function xemconlai()
gio,phut,giay = GetTimeNew()
tgc = tinhngay()*24*60*60+gio*60*60+phut*60+giay
tongtime = GetTask(144)-tgc
if tongtime <= 0 then
SetChatFlag(0)
SetTask(144,0)
Msg2Player("B¹n ®· ®­îc më khãa chat. Hi väng b¹n kh«ng t¸i ph¹m n÷a")
else
Msg2Player("Thêi gian kho¸ chat cßn l¹i lµ: "..tongtime.." gi©y")
end
end

function loidailuu()
diemtru = 0
if checkten() == 1 then
	thuhang = 1
	--for w=1,getn(danhsach) do
	--	if GetTask(145) < danhsach[w][4] then		
	--		thuhang = thuhang+1
	--	end
	--end
	--thuhang2 = thuhang+trudiem()
	AddSkillEffect(457,1,0)
	AddSkillEffect(458,1,0)
	AddSkillEffect(459,1,0)
	SetRank(216+thuhang)
	AddSkillEffect(456+thuhang,1,99999999)
else
SetRank(1)
AddSkillEffect(457,1,0)
AddSkillEffect(458,1,0)
AddSkillEffect(459,1,0)
end
end

function tinhngay()
ngay = tonumber(date("%d"))
thang = tonumber(date("%m"))
tinhngay1 = 0
for k=1,getn(mang) do
	if thang > mang[k][1] then
	tinhngay1 = tinhngay1 + mang[k][2]
	end
end
tinhngay1 = tinhngay1 + ngay
return tinhngay1
end

mang = {
{1,31},
{2,28},
{3,31},
{4,30},
{5,31},
{6,30},
{7,31},
{8,31},
{9,30},
{10,31},
{11,30},
{12,31},
}

function trudiem()
diemtru = 0
a = danhsach[1][5]
b = danhsach[2][5]
c = danhsach[3][5]
for q=1,getn(danhsach) do
	if GetUUID() == danhsach[q][2] then
		stt = q
	break
	end
	end
	if stt == 1 then
		if danhsach[1][4] == danhsach[2][4] and danhsach[1][4] == danhsach[3][4] then
			if a > b and a > c then
				diemtru = 0
			elseif a > b and a < c then
				diemtru = 1
			elseif a < b and a > c then
				diemtru = 1
			elseif a < b and a < c then
				diemtru = 2
			end
		elseif danhsach[1][4] == danhsach[2][4] then
			if danhsach[1][5] > danhsach[2][5] then
				diemtru = 0
			else
				diemtru = 1
			end
		elseif danhsach[1][4] == danhsach[3][4] then
			if danhsach[1][5] > danhsach[3][5] then
				diemtru = 0
			else
				diemtru = 1
			end
	
		end 	
	elseif stt == 2 then
		if danhsach[2][4] == danhsach[1][4] and danhsach[2][4] == danhsach[3][4] then
			if b > a and b > c then
				diemtru = 0
			elseif b > a and b < c then
				diemtru = 1
			elseif b < a and b > c then
				diemtru = 1
			elseif b < c and b < a then
				diemtru = 2
			end	
		elseif danhsach[2][4] == danhsach[1][4] then
			if danhsach[2][5] > danhsach[1][5] then
				diemtru = 0
			else
				diemtru = 1
			end
		elseif danhsach[2][4] == danhsach[3][4] then
			if danhsach[2][5] > danhsach[3][5] then
				diemtru = 0
			else
				diemtru = 1
			end		
		
		end 
	elseif stt == 3 then
		if danhsach[3][4] == danhsach[1][4] and danhsach[3][4] == danhsach[2][4] then
			if c > a and c > b then
				diemtru = 0
			elseif c > a and c < b then
				diemtru = 1
			elseif c < a and c > b then
				diemtru = 1
			elseif c < b and c < a then
				diemtru = 2
			end	
		elseif danhsach[3][4] == danhsach[1][4] then
			if danhsach[3][5] > danhsach[1][5] then
				diemtru = 0
			else
				diemtru = 1
			end
		elseif danhsach[2][4] == danhsach[3][4] then
			if danhsach[3][5] > danhsach[2][5] then
				diemtru = 0
			else
				diemtru = 1
			end	
		end 
	end
return diemtru
end


function fixloimonphai()
tong = 0
if HaveMagic(14) >= 0 then
tong = tong + 1
end
if HaveMagic(34) >= 0 then
tong = tong + 1
end
if HaveMagic(85) >=0 then
tong = tong + 1
end
if HaveMagic(99) >=0 then
tong = tong + 1
end
if HaveMagic(45) >=0 then
tong = tong + 1
end
if HaveMagic(65) >=0 then
tong = tong + 1
end
if HaveMagic(122) >=0 then
tong = tong + 1
end
if HaveMagic(135) >=0 then
tong = tong + 1
end
if HaveMagic(153) >=0 then
tong = tong + 1
end
if HaveMagic(169) >=0 then
tong = tong + 1
end
if tong > 1 then
for k=1,500 do DelMagic(k) end
Msg2SubWorld("Nh©n vËt: "..GetName().." BÞ Lçi Skill 2 Ph¸i. HÖ Thèng Tù §éng Xãa. B¹n Vui Lßng Post Lªn §Ó §­îc Admin Gi¶i QuyÕt. C¸m ¥n")
end
end



danhhieuliendau = {
{"Hang 1",217,459},
{"Hang 2",218,453},
{"Hang 3",219,457},
{"Hang 4",220,458},
}

function CapNhatDanhHieuLienDau()
checkld = 0
if getn(danhsachxephang) >= getn(danhhieuliendau) then
for i=1,getn(danhhieuliendau) do
	if GetName() == danhsachxephang[i][3] then
		for j=1,getn(danhhieuliendau) do
		if HaveMagic(danhhieuliendau[j][3]) == 1 then
			if j ~= i then
				SetRank(1)
				DelMagic(danhhieuliendau[j][3])
				KickOutSelf()
			end
		end
		end
		SetRank(danhhieuliendau[i][2])
		AddMagic(danhhieuliendau[i][3],1)
		checkld = 1
	end
end
if checkld == 0 then
	for i=1,getn(danhhieuliendau) do
		if HaveMagic(danhhieuliendau[i][3]) == 1 then
			SetRank(1)
			DelMagic(danhhieuliendau[i][3])
			KickOutSelf()
		end
	end
end
end
end


function checkdscs()
for i=1,getn(mangptcs) do
	if GetName() == mangptcs[i][2] then
		return 1
	end
end
return 0
end
function checkten()
check = 0
for q=1,getn(danhsach) do
if GetUUID() == danhsach[q][2] then
	check = 1
	break
end
end
return check
end

function TayTiemNang()
a = GetSeries()
if a == 0 then
RestAP(35,25,25,15)
elseif a == 1 then
RestAP(20,35,20,25)
elseif a == 2 then
RestAP(25,25,25,25)
elseif a == 3 then
RestAP(30,20,30,20)
elseif a == 4 then
RestAP(20,15,25,40)
end
diemtn = GetProp()
AddProp(-diemtn)
--diem = (GetLevel()-1)*5+GetTask(198)*5 + getTiemNang()
diem = (GetLevel()-1)*5+GetTask(198)*5 + GetTask(200)*10 + getTiemNang() + getTiemNangGame()
AddProp(diem)
end


function TayKyNang()
diemkn = GetMagicPoint()
AddMagicPoint(-diemkn)
--diemkn2 = (GetLevel()-1)+GetTask(199) + getKyNang()
diemkn2 = (GetLevel()-1)+GetTask(199) + getKyNang() + getKyNangGame()
AddMagicPoint(diemkn2)
RollbackSkill()
UpdateSkill()
end
function getTiemNang()
if GetTask(139) == 1 then
return 200
elseif GetTask(139) == 2 then
return 500
elseif GetTask(139) == 3 then
return 800
elseif GetTask(139) == 4 then
return 1200
elseif GetTask(139) == 5 then
return 1700
else
return 0
end
end
function getKyNang()
if GetTask(139) == 1 then
return 40
elseif GetTask(139) == 2 then
return 100
elseif GetTask(139) == 3 then
return 160
elseif GetTask(139) == 4 then
return 180
elseif GetTask(139) == 5 then
return 200
else
return 0
end
end

function getTiemNangGame()
if GetAccount() == "" or GetAccount() == "" then
return 1000
else
return 0
end
end

function getKyNangGame()
if GetAccount() == "" or GetAccount() == "" then
return 100
else
return 0
end
end
